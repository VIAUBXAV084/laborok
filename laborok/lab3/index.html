
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ekler Péter, Galuska Zoltán Bálint, Gazdi László, Kende Zoltán, Pásztor Dániel, Raisz Olivér Iván, Somogyi Norbert Zsolt">
      
      
      
        <link rel="prev" href="../lab_2/">
      
      
        <link rel="next" href="../../hf/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.14">
    
    
      
        <title>Labor 3 - Hálózati kommunikáció és adatkezelés - BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labor-3-halozati-kommunikacio-es-adatkezeles" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" class="md-header__button md-logo" aria-label="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Labor 3 - Hálózati kommunikáció és adatkezelés
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/viaubxav084/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav084/laborok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Tudnivalók
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../lab_1/" class="md-tabs__link md-tabs__link--active">
        Laborok
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hf/" class="md-tabs__link">
        Házi feladat
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" class="md-nav__button md-logo" aria-label="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/viaubxav084/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav084/laborok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Tudnivalók
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tudnivalók
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tárgy ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/contributing/" class="md-nav__link">
        Hozzájárulás az anyaghoz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab_1/" class="md-nav__link">
        Labor 1 - Kotlin Multiplatform alapok, környezet megismerése
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab_2/" class="md-nav__link">
        Labor 2 - Egyszerű felhasználói felület fejlesztése Kotlin Multiplatformon
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labor 3 - Hálózati kommunikáció és adatkezelés
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labor 3 - Hálózati kommunikáció és adatkezelés
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-kepernyok-elrendezese-es-navigacio-1-pont" class="md-nav__link">
    1. Képernyők elrendezése és navigáció (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-halozati-kommunikacio-es-felhasznaloi-felulet-kialakitasa-2-pont" class="md-nav__link">
    2. Hálózati kommunikáció és felhasználói felület kialakítása (2 pont)
  </a>
  
    <nav class="md-nav" aria-label="2. Hálózati kommunikáció és felhasználói felület kialakítása (2 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ktor-kliens-felhasznalasa" class="md-nav__link">
    Ktor kliens felhasználása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-reteg-kialakitasa" class="md-nav__link">
    Repository réteg kialakítása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-injection-bevezetese" class="md-nav__link">
    Dependency injection bevezetése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#felhasznaloi-felulet-folytatasa" class="md-nav__link">
    Felhasználói felület folytatása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-perzisztens-adattarolas-room-1-pont" class="md-nav__link">
    3. Perzisztens adattárolás: Room (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-watchlist-kepernyo-implementalasa-1-pont" class="md-nav__link">
    Önálló feladat - Watchlist képernyő implementálása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Házi feladat
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Házi feladat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/" class="md-nav__link">
        Házi feladat információk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-kepernyok-elrendezese-es-navigacio-1-pont" class="md-nav__link">
    1. Képernyők elrendezése és navigáció (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-halozati-kommunikacio-es-felhasznaloi-felulet-kialakitasa-2-pont" class="md-nav__link">
    2. Hálózati kommunikáció és felhasználói felület kialakítása (2 pont)
  </a>
  
    <nav class="md-nav" aria-label="2. Hálózati kommunikáció és felhasználói felület kialakítása (2 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ktor-kliens-felhasznalasa" class="md-nav__link">
    Ktor kliens felhasználása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-reteg-kialakitasa" class="md-nav__link">
    Repository réteg kialakítása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-injection-bevezetese" class="md-nav__link">
    Dependency injection bevezetése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#felhasznaloi-felulet-folytatasa" class="md-nav__link">
    Felhasználói felület folytatása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-perzisztens-adattarolas-room-1-pont" class="md-nav__link">
    3. Perzisztens adattárolás: Room (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-watchlist-kepernyo-implementalasa-1-pont" class="md-nav__link">
    Önálló feladat - Watchlist képernyő implementálása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="labor-3-halozati-kommunikacio-es-adatkezeles">Labor 3 - Hálózati kommunikáció és adatkezelés<a class="headerlink" href="#labor-3-halozati-kommunikacio-es-adatkezeles" title="Permanent link">&para;</a></h1>
<h2 id="bevezeto">Bevezető<a class="headerlink" href="#bevezeto" title="Permanent link">&para;</a></h2>
<p>A labor során egy filmfigyelő lista alkalmazást fogunk elkészíteni Android, IOS és Desktop platformokra. Az alkalmazásban lehet majd filmekre keresni, melyeket egy figyelő listára lehet helyezni. Figyelmet fordítunk továbbá a projekt precíz strukturálására is (packagek szerkezetének kialakítása), hogy lássunk példát egy összetettebb, nagyobb projektekben átláthatóbban használható megközelítésre is. Bár a projektünkben önmagában ez nem lenne mindig indokolt, mert viszonylag kevés fájlt fognak tartalmazni a packagek. Ha az alkalmazásunk bonyolultabb lenne és jóval több funkcióból állna, akkor kifizetődőbb lenne, mint egy sokkal egyszerűbb megközelítés. Az egyszerűség kedvéért, hogy könnyebben lehessen követni a packagek hierarchiáját, új package létrehozásakor mindig megadjuk zárójelben a package teljes, fully qualified nevét.</p>
<p>A filmek adatforrása a <a href="https://www.themoviedb.org/">TheMovieDb</a> lesz, mely biztosít egy REST-API-t filmek és sorozatok keresésére. Ehhez egy API kulcsot kell igényelni a <a href="https://developer.themoviedb.org/docs/getting-started">Developer</a> weboldalon. Ehhez regisztrálni kell, majd egy key fog megjelenni a képernyő alján. Erre később szükségünk lesz. <strong>Amennyiben nem szeretnénk a  regisztrációval és az API kulcs igényléssel foglalkozni, használhatjuk a következő API kulcsok valamelyikét:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">eyJhbGciOiJIUzI1NiJ9</span><span class="p">.</span><span class="na">eyJhdWQiOiI4N2IwMWI0Y2I1MTQwMjhkZDljMGVlMWE1NjE3Y2I1NCIsIm5iZiI6MTczOTM2MzAwMi40NzYsInN1YiI6IjY3YWM5MmJhMjFkMGE5MmQ0YjliYWFjMiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ</span><span class="p">.</span><span class="na">SNBeQWAYNi_QEl981CV6WwjCaFPZ6gGt3VE</span><span class="o">-</span><span class="n">V7Eho84</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">eyJhbGciOiJIUzI1NiJ9</span><span class="p">.</span><span class="na">eyJhdWQiOiI1NjQ2YzI3OTE3Yjg5NjYyZTVmOWM0MWNjN2YzNjc4MiIsIm5iZiI6MTc0NTYwMjcxMi40MDQsInN1YiI6IjY4MGJjODk4ZDE0OGE4MmIwZDlkMWY0NSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ</span><span class="p">.</span><span class="m">5</span><span class="n">rlt97hjf</span><span class="o">-</span><span class="n">ckbGiVg_</span><span class="o">-</span><span class="m">0</span><span class="o">-</span><span class="n">kFGxL8</span><span class="o">-</span><span class="n">D0HQX99Vr6kp7cc</span>
</code></pre></div>
<p>3 fő technológia amely használva lesz a labor során:</p>
<ul>
<li><a href="https://ktor.io/">Ktor</a>, mely segítségével fog történni a halózati kommunikáció.</li>
<li><a href="https://developer.android.com/kotlin/multiplatform/room">Room</a>, mely a lokális adatbázist fogja nyújtani.</li>
<li><a href="https://insert-koin.io/">Koin</a>, dependency injection keretrendszer.</li>
</ul>
<h2 id="elokeszuletek">Előkészületek<a class="headerlink" href="#elokeszuletek" title="Permanent link">&para;</a></h2>
<p>A feladatok megoldása során ne felejtsük el követni a <a href="../../tudnivalok/github/GitHub/">feladat beadás folyamatát</a>.</p>
<h3 id="git-repository-letrehozasa-es-letoltese">Git repository létrehozása és letöltése<a class="headerlink" href="#git-repository-letrehozasa-es-letoltese" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Moodle-ben keressük meg a laborhoz tartozó meghívó URL-jét és annak segítségével hozzuk létre a saját repositoryt.</p>
</li>
<li>
<p>Várjuk meg, míg elkészül a repository, majd checkout-oljuk ki.</p>
</li>
<li>
<p>Hozzunk létre egy új ágat <code>megoldas</code> néven, és ezen az ágon dolgozzunk.</p>
</li>
<li>
<p>A <code>neptun.txt</code> fájlba írjuk bele a Neptun kódunkat. A fájlban semmi más ne szerepeljen, csak egyetlen sorban a Neptun kód 6 karaktere.</p>
</li>
<li>
<p>Indítsuk el az Android Studio-t vagy az Intellij-t, majd nyissuk meg a kapott kezdőprojektet.</p>
</li>
<li>
<p>Ellenőrizzük, hogy a létrejött projekt lefordul és futtatható mobil és desktop platformokon. A kiinduló projektünk tartalmazza az összes szükséges gradle függőséget, ezért ezeket nem kell már felvennünk a labor során.</p>
</li>
</ol>
<p><a class="glightbox" href="assets/hello_world.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Starter stage" src="assets/hello_world.png" /></a></p>
<h2 id="1-kepernyok-elrendezese-es-navigacio-1-pont">1. Képernyők elrendezése és navigáció (1 pont)<a class="headerlink" href="#1-kepernyok-elrendezese-es-navigacio-1-pont" title="Permanent link">&para;</a></h2>
<p>A 2. laborhoz hasonlóan alakítsuk ki először az alkalmazás navigációjának alapját. Hozzunk létre a commonMain-ben egy <strong>navigation</strong> packaget, (kotlin/hu/bme/aut/navigation) azon belül egy <strong>Route enum class</strong>-t az alábbi tartalommal:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.automirrored.filled.List</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Search</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.vector.ImageVector</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Route</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="p">:</span><span class="w"> </span><span class="n">ImageVector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Search</span><span class="p">(</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Search&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Search</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">Watchlist</span><span class="p">(</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Watchlist&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">AutoMirrored</span><span class="p">.</span><span class="na">Filled</span><span class="p">.</span><span class="na">List</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Ez az osztály fogja definiálni a képernyőket a navigáció számára. Ahogy látható, 2 fő képernyőből fog állni az alkalmazás: egy Search képernyő, ahol lehet majd keresni a filmekre és egy WatchList képernyő.</p>
<p>Célszerű lenne, hogy az alkalmazás a 2 mobilplatformon hasonlítson, ellenben desktopon eltérő layout-ja legyen. Ezt jelenleg csak kód duplikációval tudnánk elérni, vagyis az iosMain-ben és androidMain-ben duplikálva az ő megjelenésükért szükséges kódok duplán lennének. Ha jobban megnézzük, definiálva van a kezdőprojektben már egy mobileMain source set a <code>build.gradle.kts</code>-ben, melyre dependálnak az ios és az android platformok. Így fogjuk elérni azt, hogy mobil platformokon közös, de a többi (esetünkben desktop) platformtól különböző elrendezésben alakíthassuk ki a felhasználói felületünket.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">mobileMain</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dependsOn</span><span class="p">(</span><span class="n">commonMain</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">androidMain</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">getting</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dependsOn</span><span class="p">(</span><span class="n">mobileMain</span><span class="p">)</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="n">így</span><span class="w"> </span><span class="n">az</span><span class="w"> </span><span class="n">android</span><span class="w"> </span><span class="n">eléri</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">mobileMain</span><span class="w"> </span><span class="n">kódját</span>
<span class="p">}</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">iosX64Main</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">getting</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">iosArm64Main</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">getting</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">iosSimulatorArm64Main</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">getting</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">desktopMain</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">getting</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">iosMain</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dependsOn</span><span class="p">(</span><span class="n">mobileMain</span><span class="p">)</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="n">így</span><span class="w"> </span><span class="n">az</span><span class="w"> </span><span class="n">ios</span><span class="w"> </span><span class="n">eléri</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">mobileMain</span><span class="w"> </span><span class="n">kódját</span>
<span class="w">    </span><span class="n">iosX64Main</span><span class="p">.</span><span class="na">dependsOn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">iosArm64Main</span><span class="p">.</span><span class="na">dependsOn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">    </span><span class="n">iosSimulatorArm64Main</span><span class="p">.</span><span class="na">dependsOn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Hozzunk létre egy <em>mobileMain</em> directory-t a többi sourceset mellett (composeApp &gt; src directoryn jobb klikk &gt; New &gt; Directory).</p>
<p><a class="glightbox" href="assets/mobile_sourceset.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Mobile Sourceset" src="assets/mobile_sourceset.png" /></a></p>
<p>Ezután szükségünk lesz egy, a platformok navigációjának megjelenéséért felelős kódra. Itt fogjuk szabályozni, milyen elrendezésben jelenjen meg a navigáció felhasználói felülete mobil, illetve desktop platformokon. A közös kódban a ui packegen belül hozzunk létre egy PlatformLayout.kt-t az alábbi tartalommal.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.navigation.Route</span>

<span class="nd">@Composable</span>
<span class="kd">expect</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformLayout</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navigationBarItems</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Route</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">selectedItem</span><span class="p">:</span><span class="w"> </span><span class="n">Route</span><span class="p">,</span>
<span class="w">    </span><span class="n">onNavigationItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Route</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span>
</code></pre></div>
<p>Itt kihasználjuk az <strong>expect-actual</strong> mechanizmusát a KMP-nek és a platformok fogják megmondani, hogyan jelenjenek meg az egyes képernyők. A <em>PlatformLayout</em> egy composable elem, amely a szokásos modifieren túl átveszi a navigation bar elemeit, az azokból éppen kijelölt elemet, a navigáció elemein való kattintáskor végzendő műveletet, illetve a layout tartalmát. </p>
<div class="admonition info">
<p class="admonition-title">Automatikusan generált actual megvalósítások<p>A fejlesztőkörnyezetek alapvetően biztosítják ezt a funkciót, azonban ezek nem mindig működnek megfelelően. Létrehozhatjuk kézzel is ezeket az actual implementációkat, a szükséges fájlokat kézzel ugyanolyan packagebe, mint amilyenben azok expect párja található. Amennyiben automatikusan generáljuk, de azt tapasztaljuk, hogy nem generálta le a szükséges actual megvalósításokat, akkor ellenőrizzük le, hogy valóban hiányoznak-e. Desktop platformon például hajlamos a composeApp\build\generated\ksp\desktop\desktopMain... (vagy ehhez hasonló) útvonalra generálni az actual megvalósítást tartalmazó fájlt. Amennyiben ezt tapasztaljuk, keressük meg itt, hozzuk létre kézzel a megfelelő package(ke)t, és helyezzük át ide a generált fájlt.Amennyiben valóban nem generálódott semmilyen fájl (ez viszonylag ritka, de nem lehetetlen), létrehozhatjuk kézzel, vagy megpróbálhatjuk újragenerálni.</p>
</p>
</div>
<p>Alt+Enter segítségével (vagy kézzel) hozzuk létre a desktop és a mobile sourceseteken az actual implementációkat, ekkor létrejönnek a <code>PlatformLayout.desktop.kt</code> és a <code>PlatformLayout.mobile.kt</code> fájlok. </p>
<p>Ezek nézzenek ki az alábbi módon:</p>
<p><code>PlatformLayout.desktop.kt</code> :
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.NavigationRail</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.NavigationRailItem</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.navigation.Route</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformLayout</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navigationBarItems</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Route</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">selectedItem</span><span class="p">:</span><span class="w"> </span><span class="n">Route</span><span class="p">,</span>
<span class="w">    </span><span class="n">onNavigationItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Route</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Row</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NavigationRail</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(</span><span class="m">0.2f</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">navigationBarItems</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">navigationItem</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">NavigationRailItem</span><span class="p">(</span>
<span class="w">                    </span><span class="n">selected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectedItem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">navigationItem</span><span class="p">,</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">onNavigationItemClick</span><span class="p">(</span><span class="n">navigationItem</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
<span class="w">                    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navigationItem</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span>

<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">content</span><span class="p">(</span><span class="n">Modifier</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><code>PlatformLayout.mobile.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.navigation.Route</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformLayout</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navigationBarItems</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Route</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">selectedItem</span><span class="p">:</span><span class="w"> </span><span class="n">Route</span><span class="p">,</span>
<span class="w">    </span><span class="n">onNavigationItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Route</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">bottomBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">NavigationBar</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">navigationBarItems</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navigationItem</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">NavigationBarItem</span><span class="p">(</span>
<span class="w">                        </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navigationItem</span><span class="p">.</span><span class="na">title</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">                        </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">onNavigationItemClick</span><span class="p">(</span><span class="n">navigationItem</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">                        </span><span class="n">selected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navigationItem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">selectedItem</span><span class="p">,</span>
<span class="w">                        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">navigationItem</span><span class="p">.</span><span class="na">icon</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">paddingValues</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">content</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">paddingValues</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Desktop esetén egy oldalsó navigációs panelt (<em>NavigationRail</em>), mobil esetén pedig egy megszokott <em>NavigationBart</em> használunk.</p>
<p>Használjuk fel ezután a <em>PlatformLayout-unkat</em> az <code>App.kt</code> fájlunk fő composablejében, ez a <em>PlatformLayout</em> fog renderelődni az alkalmazás indításakor. Alakítsuk ki a navigációt is az előző laboron látottakhoz hasonlóan, és adjuk meg a megfelelő elemeit a <em>PlatformLayout</em> megfelelő paramétereinek:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.NavHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.currentBackStackEntryAsState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.rememberNavController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.navigation.Route</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.PlatformLayout</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.theme.AppTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.ui.tooling.preview.Preview</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AppTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">backStackEntry</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">currentBackStackEntryAsState</span><span class="p">()</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentScreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span>
<span class="w">            </span><span class="n">backStackEntry</span><span class="o">?.</span><span class="na">destination</span><span class="o">?.</span><span class="na">route</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Search</span><span class="p">.</span><span class="na">title</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">PlatformLayout</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">            </span><span class="n">navigationBarItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">entries</span><span class="p">,</span>
<span class="w">            </span><span class="n">onNavigationItemClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">selectedItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentScreen</span><span class="p">,</span>
<span class="w">            </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">contentModifier</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contentModifier</span><span class="p">,</span>
<span class="w">                    </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navController</span><span class="p">,</span>
<span class="w">                    </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Search</span><span class="p">.</span><span class="na">title</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Search</span><span class="p">.</span><span class="na">title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Search</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Watchlist</span><span class="p">.</span><span class="na">title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Watchlist</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Futtassuk az alkalmazást, próbáljuk ki egy mobilos, és desktop platformon is. A következő(höz hasonló) elrendezést kell látnunk.</p>
<p><a class="glightbox" href="assets/navigation.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Navigation" src="assets/navigation.png" /></a></p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készítsünk egy <strong>képernyőképet</strong>, amelyen az elindított alkalmazás nézete látszik desktopon és mobil platformon egymás mellett! A kép a megoldásban a repositoryban f1.png néven szerepeljen!</p>
</div>
<h2 id="2-halozati-kommunikacio-es-felhasznaloi-felulet-kialakitasa-2-pont">2. Hálózati kommunikáció és felhasználói felület kialakítása (2 pont)<a class="headerlink" href="#2-halozati-kommunikacio-es-felhasznaloi-felulet-kialakitasa-2-pont" title="Permanent link">&para;</a></h2>
<h3 id="ktor-kliens-felhasznalasa">Ktor kliens felhasználása<a class="headerlink" href="#ktor-kliens-felhasznalasa" title="Permanent link">&para;</a></h3>
<p>Alakítsuk most ki a hálózati kommunikációnkat a Ktor kliens API segítségével.</p>
<p>Hozzunk létre a közös kódban egy <em>data</em> (<em>hu.bme.aut.data</em>) packaget és azon belül egy <em>network</em> (<em>hu.bme.aut.data.network</em>) packaget, melyben a hálózati kommukációhoz tartozó adatokhoz kapcsolódó részek lesznek. Hozzunk létre ide egy <code>TMDBResponse.kt</code> fájlt, ide fognak kerülni a kapcsolódó adatosztályok, melyek a használt API válaszaira adnak DTO-kat. Egy filmről el fogjuk tárolni az azonosítóját, címét és posterjéhez tartozó elérési útvonalat (path), mely nem minden film esetén biztosított, ezért nullablere állítjuk.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.SerialName</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.Serializable</span>

<span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MovieResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;poster_path&quot;</span><span class="p">)</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">posterPath</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TMDbResponse</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MovieResponse</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>
<p>Ugyanebben a packageben készítsük el magát az API klienst (<code>TMDBApiClient.kt</code>), amely a Ktor kliens API segítségével fogja elvégezni a hálózati kommunikációt. Itt eltároljuk az API alap URL-jét, illetve definiáljuk a kétféle kérésünkhöz tartozó műveleteket. Az egyszerűség kedvéért az alkalmazásban csak két api hívás lesz, a <strong>getPopularMovies()</strong> a_ <em>TheMovieDB</em> adatbázisban eltárolt aktuálisan legnépszerübb filmeket fogja visszaadni, a <strong>searchMovie(title : String)</strong> segítségével pedig lehet majd szövegesen keresni a filmek között. Az eredmény egy <em>HttpResponse</em> típusú objektum lesz, amelynek body-jából tudjuk kinyerni a visszaadott adatokat. A kliens get kérését paraméterezzük is: beállítjuk a <em>language</em> és <em>page</em> paramétereket.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.call.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.request.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.statement.*</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">TMDBApiClient</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://api.themoviedb.org/3&quot;</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getPopularMovies</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MovieResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="n">HttpResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">baseUrl</span><span class="s">/movie/popular&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">parameter</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en-US&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">parameter</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="o">&lt;</span><span class="n">TMDbResponse</span><span class="o">&gt;</span><span class="p">().</span><span class="na">results</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchMovie</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MovieResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="p">:</span><span class="w"> </span><span class="n">HttpResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">baseUrl</span><span class="s">/search/movie?query=</span><span class="si">$</span><span class="n">title</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">parameter</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en-US&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">parameter</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="o">&lt;</span><span class="n">TMDbResponse</span><span class="o">&gt;</span><span class="p">().</span><span class="na">results</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A következő lépés az adott platformoknak megfelelő HttpClient létrehozása lesz a közös kódban. Továbbra is a network packagen belül hozzunk létre egy <code>ProvideApiBaseClient.kt</code> fájlt az alábbi tartalommal. Az API kulcs helyére akár az igényelt, akár a megadott 2 api kulcs valamelyikét illesszük be!</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.auth.Auth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.auth.providers.BearerTokens</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.auth.providers.bearer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.contentnegotiation.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.logging.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.serialization.kotlinx.json.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.json.Json</span>

<span class="kd">expect</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">platformClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpBaseClient</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platformClient</span><span class="p">().</span><span class="na">config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">ContentNegotiation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">json</span><span class="p">(</span>
<span class="w">            </span><span class="n">Json</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ignoreUnknownKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="n">encodeDefaults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">Auth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bearer</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">loadTokens</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">BearerTokens</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;IDE_AZ_API_KULCS&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="kc">null</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">Logging</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;[HttpClient] </span><span class="si">$</span><span class="n">message</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogLevel</span><span class="p">.</span><span class="na">ALL</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A <strong>platformClient()</strong> feladata elkérni az adott platformoktól a megfelelő <strong>HttpClienteket</strong>, majd ezen a config blockon belül pluginok hozzáadása. Jelen esetben, a hálózati kommunkáció során a tényleges tartalom JSON-ok formájában fog utazni, ezért ezt állítjuk be (<em>ContentNegotiation</em> blokk <em>Json</em> beállítása). Az Api hívások során az igényelt API tokent az <em>Authorization</em> header-ben kell megadni, ehhez az <em>Auth</em> plugint használjuk. A  kommunikáció <em>Bearer</em> típusú lesz, itt adjuk meg az API kulcsot is. Továbbá  szeretnénk az egyszerűbb debuggolás érdekében, hogy a hálózati kommunikáció megjelenjen a console-on is.</p>
<p>Ezzel elkészült a közös kódban definiált <em>HttpClient</em>, ennek a konkrét megvalósításait a különböző platformokon használt megfelelő natív API segítségével tudjuk kialakítani. Alt+Enter segítségével vagy kézzel hozzuk létre a platformoknak megfelelő <strong>HttpClienteket</strong> tartalmazó fájlokat. Jelen esetben androidMain, iosMain és desktopMain platformokra lesz szükségünk. Ezekben platform-specifikus módon, az adott platformon használható <em>HttpClient-et</em> (<em>OkHttp</em> androidon és desktopon, <em>Darwin</em> iOS-en) szolgáltatunk a Ktor számára.</p>
<p><code>ProvideApiBaseClient.ios.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.engine.darwin.*</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">platformClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">Darwin</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<p><code>ProvideApiBaseClient.android.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.engine.okhttp.*</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">platformClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">OkHttp</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<p><code>ProvideApiBaseClient.desktop.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.engine.okhttp.*</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">platformClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">OkHttp</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="repository-reteg-kialakitasa">Repository réteg kialakítása<a class="headerlink" href="#repository-reteg-kialakitasa" title="Permanent link">&para;</a></h3>
<p>A hálózati hívások (és egyéb, hozzájuk köthető származtatott műveletek) elérését tipikusan nem közvetlenül szoktuk végezni, hanem egy extra réteget, a Repository-t vezetjük be, amelyen keresztül fogjuk tudni elérni a megfelelő műveleteket. A Repository tehát absztrakcióként szolgál a HttpClient-ek fölött, amelyek a tényleges hálózati kommunikációt végzik. Így fogunk most mi is eljárni. A közös kódban a data packagen belül hozzunk létre egy <em>repository</em> packaget (<em>hu.bme.aut.data.repository</em>), azon belül egy <strong>MovieRepository</strong> interfacet.</p>
<p><code>MovieRepository.kt</code> :
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">MovieRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">storedMovies</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getMovies</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchMoveByTitle</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getPopularMovies</span><span class="p">()</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addMovieToWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">removeMovieFromWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Itt deklaráljuk az alkalmazásunkban elérhető műveleteket. Láthatjuk, hogy suspend függvényekről van szó, amelyek Flow-n keresztül teszik elérhetővé az eredmények lekérdezését (amennyiben van ilyen).</p>
<p>Hozzuk létre a filmeket reprezentáló adatmodellt is. Ehhez a data package-el egyszinten készítsünk egy <em>domain</em> packaget (<em>hu.bme.aut.domain</em>). A <em>domain-en</em> belül pedig egy <em>model</em> packaget vegyünk fel (<em>hu.bme.aut.domain.model</em>), benne egy <em>Movie</em> data class-al. Ez az osztály lesz felelős a filmek alkalmazásunkon belüli reprezentálásáért.</p>
<p>Movie.kt:
<div class="highlight"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Movie</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">posterPath</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">onWatchlist</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></p>
<p>Ezután implementáljuk a <strong>MovieRepository-t</strong>: hozzunk létre egy <em>impl</em> packaget a repository-n belül (<em>hu.bme.aut.data.repository.impl</em>) benne az alábbi osztállyal (<em>MovieRepositoryImpl</em>).</p>
<p><div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.mapper.toMovieDomain</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.network.TMDBApiClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.repository.MovieRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.*</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MovieRepositoryImpl</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tMDBApiClient</span><span class="p">:</span><span class="w"> </span><span class="n">TMDBApiClient</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MovieRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">movieResultFlow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">emptyList</span><span class="p">())</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getMovies</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movieResultFlow</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchMoveByTitle</span><span class="p">(</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">movies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tMDBApiClient</span><span class="p">.</span><span class="na">searchMovie</span><span class="p">(</span><span class="n">title</span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">toMovieDomain</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">movieResultFlow</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movies</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getPopularMovies</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">movies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tMDBApiClient</span><span class="p">.</span><span class="na">getPopularMovies</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">it</span><span class="p">.</span><span class="na">toMovieDomain</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">movieResultFlow</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movies</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">     </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">storedMovies</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO</span><span class="p">(</span><span class="s">&quot;Not yet implemented&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addMovieToWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO</span><span class="p">(</span><span class="s">&quot;Not yet implemented&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">removeMovieFromWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO</span><span class="p">(</span><span class="s">&quot;Not yet implemented&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Ez az osztály valósítja meg a Repository interface-ünket. Láthatjuk, hogy a korábbiakban elkészített <em>TMDBApiClient</em> osztályunkat használja fel a hálózati kommunikáció elvégzéséhez. A <em>storedMovies</em>, <em>addMovieToWatchList</em> és <em>removeMovieFromWatchList</em> metódusok még nincsenek implementálva, azokkal később foglalkozunk majd.  A <em>searchMoveByTitle</em> és <em>getPopularMovies</em> metódusok viszont már meg vannak valósítva: az api kliens megfelelő metódusait meghívva megkapják az eredményt, majd a tagváltozóként felvett Flow-n keresztül (<code>movieResultFlow</code>) frissíti azt (<code>movieResultFlow.update</code>). Az eredményt a klienstől azonban a korábban elkészített <em>MovieResponse</em> osztály (DTO) példányaként kapjuk meg, amely nem kompatibilis közvetlenül az alkalmazás modelljeként használt <em>Movie</em> osztállyal.</p>
<p>Ezért szükségünk lesz még egy Mapper készítésére is az Api model -&gt; Domain model között. Ezt már használjuk a Repositoryban (<code>it.toMovieDomain()</code>), azonban még nem valósítottuk meg, ezért jelenleg fordítási hibát kapunk rá. Ezért a data packagen belül hozzunk létre egy <em>mapper</em> packaget (<em>hu.bme.aut.data.mapper</em>), azon belül egy <strong>MovieMapper.kt</strong> fájlt az alábbi tartalommal.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.network.MovieResponse</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>

<span class="kd">fun</span><span class="w"> </span><span class="n">MovieResponse</span><span class="p">.</span><span class="nf">toMovieDomain</span><span class="p">(</span><span class="n">onWatchList</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Movie</span><span class="p">(</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">title</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;https://image.tmdb.org/t/p/w500/</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="na">posterPath</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">onWatchList</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>Itt egy kotlin nyelvi elemet, az <em>extension functiont</em> használjuk: a <em>MovieResponse</em> osztályt kiterjesztjük egy <em>toMovieDomain</em> metódussal, amely paraméterként átveszi, hogy figyelő listán volt-e a film, majd elvégzi a konverziót a DTO és a model osztályok között. Ha mindent jól csináltunk, mostmár fordulnia kell a <em>MovieRepositoryImpl</em> osztálynak is.</p>
<p>A <strong>MovieResponse</strong> posterPath-je nem tartalmazza a teljes útvonalat a képekhez. Ez azért van, mert a TheMovieDB más subdomaint biztosít a kép elérésére, továbbá lehet felbontást is változtatni (w500) a kisebb hálózati forgalom érdekében, amelyet szintén az elérés részeként (pl. /w500) adhatunk  meg.</p>
<h3 id="dependency-injection-bevezetese">Dependency injection bevezetése<a class="headerlink" href="#dependency-injection-bevezetese" title="Permanent link">&para;</a></h3>
<p>Alakítsuk most ki az alkalmazásunkban a dependency injection használatának alapjait is, a 2. laborhoz hasonló módon most is a <em>Koin</em> segítségével. Hozzunk létre egy <strong>di</strong> (<em>hu.bme.aut.di</em>) packaget a data és domain packagekkel egyszinten. Ebben a packageben fogjuk definiálni az összes függőség közötti kapcsolatot. Hozzuk létre a Koin data moduleját, a <em>DataModule.kt</em> fájlban az alábbi tartalommal:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.network.TMDBApiClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.network.provideHttpBaseClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.repository.MovieRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.repository.impl.MovieRepositoryImpl</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.singleOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.bind</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">dataModule</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">single</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">provideHttpBaseClient</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">single</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TMDBApiClient</span><span class="p">(</span><span class="k">get</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">singleOf</span><span class="p">(</span><span class="o">::</span><span class="n">MovieRepositoryImpl</span><span class="p">)</span><span class="w"> </span><span class="n">bind</span><span class="w"> </span><span class="n">MovieRepository</span><span class="o">::</span><span class="kd">class</span>
<span class="err">}</span>
</code></pre></div>
<p>Három típusú függőség injektálását definiáljuk. A HttpClient esetén a provideHttpBaseClient metódust hívjuk meg. a TMDPApiClient esetén egyszerűen példányosítjuk a TMDBApiClient osztályunkat, azonban figyelnünk kell arra is, hogy ez az osztály is vár egy függőséget konstruktorában (HttpClient). Ezért példányosításakor a Koin <em>get()</em> metódusát hívva injektáljuk a függőségét. Az utolsó pedig a következőket éri el:</p>
<div class="highlight"><pre><span></span><code>1. A singleOf a single-hez hasonlóan egy singleton példányt hoz létre, csak ez az egy példány jön létre és minden, ezt a függőséget felhasználó objektum ugyanazt a példányt fogja használni.
2. A ::::MovieRepositoryImpl Kotlinos konstruktor referencia. Lényegében azt jelenti, hogy &quot;hozz létre a _MovieRepositoryImpl_ osztály egy példányát a konstruktorának felhasználásával&quot;.
3. A `bind MovieRepository::class` a _MovieRepositoryImpl_ osztályt hozzáköti a _MovieRepository_ interfacehez, vagyis mindig, amikor egy _MovieRepository_ típusú függőséget várunk, egy _MovieRepositoryImpl_ példányt kell injektálni.
</code></pre></div>
<h3 id="felhasznaloi-felulet-folytatasa">Felhasználói felület folytatása<a class="headerlink" href="#felhasznaloi-felulet-folytatasa" title="Permanent link">&para;</a></h3>
<p>Folytassuk most a felhasználói felületünk kialakítását, valósítsuk meg a filmeket megjelenítő képernyőt és a hozzá tartozó infrastruktúrát is. Hozzunk létre a <em>ui</em> packageben egy <em>feature</em> (<em>hu.bme.aut.ui.feature</em>) packaget, benne hozzunk létre egy <em>search</em> packaget (<em>hu.bme.aut.ui.feature.search</em>). Ide helyezzük majd a SearchScreen-hez köthető képernyőket és a hozzájuk tartozó ViewModeleket.</p>
<p>Készítsük most el a keresés képernyőt és a hozzátartozó ViewModelt.</p>
<p><code>SearchScreenViewModel.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.repository.MovieRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.FlowPreview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.StateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.collectLatest</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.debounce</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">FlowPreview</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SearchScreenViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">movieRepository</span><span class="p">:</span><span class="w"> </span><span class="n">MovieRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_searchQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">searchQuery</span><span class="p">:</span><span class="w"> </span><span class="n">StateFlow</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_searchQuery</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">movies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movieRepository</span><span class="p">.</span><span class="na">getMovies</span><span class="p">()</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">getPopularMovies</span><span class="p">()</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_searchQuery</span><span class="p">.</span><span class="na">debounce</span><span class="p">(</span><span class="m">500</span><span class="p">).</span><span class="na">collectLatest</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">movieRepository</span><span class="p">.</span><span class="na">searchMoveByTitle</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">getPopularMovies</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getPopularMovies</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movieRepository</span><span class="p">.</span><span class="na">getPopularMovies</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">searchQuery</span><span class="p">(</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_searchQuery</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">title</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ahogy láthatjuk, a ViewModel a konstruktorában várja a repository-t, amelynek a műveleteit fogja hívni. Mikor létrejön a ViewModel, az init{} blokkjában meghívja a repository <em>getPopularMovies()</em> függvényétegy korutinban (<em>viewModelScope.launch</em>), hogy megtörténjen a hálózati hívás, továbbá felirakozik egy belső flow-ra, mely a keresési szabadszöveges keresés Stringjét tárolja el. A Debounce 500ms szerepe pedig, hogy késlelteti a keresést fél másodpercig. A ViewModel létrejöttekor meghívja a a repository <em>getMovies</em> metódusát is, amellyen feltölti a tárolt filmek listáját.</p>
<p>Hozzuk most létre a kereső képernyőt (<code>SearchScreen.kt</code>) a ViewModel-el egyszinten (<em>hu.bme.aut.ui.feature.search.SearchScreen</em>).</p>
<p><code>SearchScreen.kt</code>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedTextField</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.component.PlatformMovieList</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.feature.movie.MovieCard</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.theme.AppTypography</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.viewmodel.koinViewModel</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">SearchScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">SearchScreenViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinViewModel</span><span class="p">()</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">movies</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">movies</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">(</span><span class="n">emptyList</span><span class="p">())</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">searchQuery</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">searchQuery</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">background</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">textStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppTypography</span><span class="p">.</span><span class="na">body2</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">primary</span><span class="p">)</span><span class="w"> </span><span class="p">,</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchQuery</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">viewModel</span><span class="p">.</span><span class="na">searchQuery</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s">&quot;Search Movies&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">singleLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">PlatformMovieList</span><span class="p">(</span><span class="n">movies</span><span class="p">){</span>
<span class="w">            </span><span class="n">MovieCard</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>A Screen konstruktorában a ViewModel-t a <strong>koin</strong> fogja biztosítani a koinViewModel() hívás által. Ehhez azonban még készítenünk kell egy koin Module-t, ahol ViewModelek függőségeit fogjuk definiálni.</p>
<p>A <em>PlatformMovieList</em> és <em>MovieCard</em> composablek importálása még egyelőre hibát okoz, hozzuk most létre őket. A korábbiaknak megfelelően ugyanis szükséges lenne, hogy az alkalmazásunk listanézete eltérjen a két platformon. Mobil képernyőkön egymás alatt jelenjenek (<em>LazyList</em>) meg az egyes film kártyák, de desktopon táblázatszerűen (<em>ListVerticalGrid</em>).</p>
<p>Hozzunk létre egy <code>PlatformMovieList.kt</code> fájlt a ui/component packageben (_hu.bme.aut.ui.component), ennek feladata lesz a paraméterként kapott filmek elrendezésének megszabása, de az egyes filmek megjelenítése a lamdbaként kapott composable függvény formájában lesz megadva.</p>
<p><code>PlatformMovieList.kt</code>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>

<span class="nd">@Composable</span>
<span class="kd">expect</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformMovieList</span><span class="p">(</span>
<span class="w">    </span><span class="n">movieList</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">drawMovie</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span>
</code></pre></div></p>
<p>Mivel egységes megjelenítést szeretnénk Androidon és iOS-en, ezért a mobileMain SourceSet-ben hozzuk létre az implementációt, ugyanolyan packageben, mint amit a közös kódban is létrehoztunk (<em>hu.bme.aut.ui.component</em>).</p>
<p><code>PlatformMovieList.mobile.kt</code>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.LazyColumn</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.items</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformMovieList</span><span class="p">(</span>
<span class="w">    </span><span class="n">movieList</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">drawMovie</span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LazyColumn</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">items</span><span class="p">(</span><span class="n">movieList</span><span class="p">){</span><span class="w"> </span><span class="n">movie</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">drawMovie</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Itt definiáljuk, hogy mobilos platformok esetén egy egyszerű listaszerű megjelenítést szeretnénk a filmeknek, ahol a kapott lambda mondja meg, hogy egy konkrét filmet hogyan jelenítsünk meg.</p>
<p><code>PlatformMovieList.desktop</code></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.grid.GridCells</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.grid.LazyVerticalGrid</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.grid.items</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">PlatformMovieList</span><span class="p">(</span>
<span class="w">    </span><span class="n">movieList</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">drawMovie</span><span class="p">:</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">(</span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LazyVerticalGrid</span><span class="p">(</span>
<span class="w">        </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GridCells</span><span class="p">.</span><span class="na">Adaptive</span><span class="p">(</span><span class="n">minSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">items</span><span class="p">(</span><span class="n">movieList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">movie</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">drawMovie</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Desktop esetén pedig egy gridesített megjelenítést alkalmazunk, egy film megjelenítése ugyanúgy a lambda segítségével történik.</p>
<p>A filmeket a megszokott Card-szerű formátumban fogjuk megjeleníteni, hozzuk most létre a közös kódban a <code>MovieCard.kt</code> fájlunkat, amely a szükséges Composable elemet fogja tartalmazni. Ezt a feature/movie packagebe helyezzük (<em>hu.bme.aut.feature.movie</em>), mert később további funkcionalitást is fog kapni a kártya, amely nem a kereséshez köthető.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil3.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">MovieCard</span><span class="p">(</span>
<span class="w">    </span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Box</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Card</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">elevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CardDefaults</span><span class="p">.</span><span class="na">cardElevation</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">posterPath</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movie</span><span class="p">.</span><span class="na">posterPath</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Poster for </span><span class="si">${</span><span class="n">movie</span><span class="p">.</span><span class="na">title</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">200.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezután az App.kt belépési pontján cseréljük ki az ideiglenes Text(text = Route.Search.title) composable-t a SearchScreen()-re:</p>
<p><code>App.kt</code>:
<div class="highlight"><pre><span></span><code><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Route</span><span class="p">.</span><span class="na">Search</span><span class="p">.</span><span class="na">title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SearchScreen</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Jelen állapotban minden kész ahhoz, hogy lehessen használni az alkalmazást, ellenben mégsem fog működni. A hiányzó, ViewModel-ekhez tartozó <strong>DI</strong> függőségeket kell még definiálnunk. Ehhez a közös kódbban a <strong>DI</strong> packagen belül (hu.bme.aut.di) hozzunk létre egy <strong>ViewModelModule-t</strong> az alábbi tartalommal.</p>
<p><code>ViewModelModule.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.feature.search.SearchScreenViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">viewModelModule</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SearchScreenViewModel</span><span class="p">(</span><span class="k">get</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Itt definiáljuk a ViewModel-ekkel kapcsolatos függőségeket, melyre speciális támogatást nyújt a Koin. Azt adjuk meg, hogy valahányszor a Koin <em>viewmodel()</em> hívását használjuk (ahogy azt a SearchScreen-ben meg is tettük), a SearchScreenViewModel példányát injektáljuk. Annak konstruktor paraméterében a <em>get()</em> hívás szerepe ugyanaz, mint amit korábban láttunk.</p>
<p>Vegyünk fel továbbá egy AppModule-t is, amely az alkalmazás moduljainak felsorolását tartalmazza. Vegyük észre, hogy több modult is használunk már: a korábban létrehozott DataModule-t, és az újonnan készített ViewModelModule-t. Ide helyezünk továbbá egy initializeKoin függvényt, mely átadja a koin számára a definiált függőségeket. Ezt azért tesszük meg, hogy a különböző platformokon ne kelljen azt mindenhol duplikálnunk.</p>
<p><code>AppModule.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.context.startKoin</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">appModule</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">includes</span><span class="p">(</span>
<span class="w">        </span><span class="n">dataModule</span><span class="p">(),</span>
<span class="w">        </span><span class="n">viewModelModule</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">initializeKoin</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startKoin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">modules</span><span class="p">(</span><span class="n">appModule</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ezután szükséges minden platformon meghívni az initializeKoin függvényt, mellyel "bekapcsoljuk" a Koint az adott platformon.</p>
<p>Androidon:</p>
<p><code>MainActivity.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.di.initializeKoin</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MainActivity</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ComponentActivity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
<span class="w">        </span><span class="n">initializeKoin</span><span class="p">()</span>
<span class="w">        </span><span class="n">setContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">App</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Desktopon:</p>
<p><code>main.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.window.Window</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.window.application</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.di.initializeKoin</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Window</span><span class="p">(</span>
<span class="w">        </span><span class="n">onCloseRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">exitApplication</span><span class="p">,</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MyMovieWatchList&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">initializeKoin</span><span class="p">()</span>
<span class="w">        </span><span class="n">App</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>iOS-en:</p>
<p><code>MainViewController.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.window.ComposeUIViewController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.di.initializeKoin</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">MainViewController</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComposeUIViewController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">initializeKoin</span><span class="p">()</span>
<span class="w">    </span><span class="n">App</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Továbbá, az AndroidManifest fájlban adjuk hozzá a következő sort az engedélyekhez, hogy az alkalmazás hozzáférjen az internethez.</p>
<p><code>AndroidManifest.xml</code>:
<div class="highlight"><pre><span></span><code><span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div></p>
<p>Jelen állapotban indítható az alkalmazás, és kereshetőek a filmek. Próbáljuk ki, az alábbihoz hasonlót kell látnunk!</p>
<p><a class="glightbox" href="assets/api_result.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Api result" src="assets/api_result.png" /></a></p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készítsünk egy <strong>képernyőképet</strong>, amelyen az elindított alkalmazás SearchScreen képernyője látszik desktopon és mobil platformon egymás mellett! A kép a megoldásban a repositoryban f2.png néven szerepeljen!</p>
</div>
<h2 id="3-perzisztens-adattarolas-room-1-pont">3. Perzisztens adattárolás: Room (1 pont)<a class="headerlink" href="#3-perzisztens-adattarolas-room-1-pont" title="Permanent link">&para;</a></h2>
<p>Térjünk most rá a perzisztens adattárolás létrehozására. Ehhez a Room könyvtárat fogjuk használni, amely egy kliens oldali SQLite adatbázis felett biztosít ORM támogatást. A Room az android ökoszisztémában jól bevált és elterjedt megoldás, a 2.7.0-alpha01 verziótól kezdve pedig már Kotlin Multiplatform környezetben is használható.
<a href="https://developer.android.com/kotlin/multiplatform/room">Részletes dokumentáció</a></p>
<p>A Room bekötése az alkalmazásba 4 fő elemből áll, az alábbiakat kell elvégeznünk:
- <strong>Movie Entitás</strong> definiálás, mely a Movie táblát fogja reprezentálni az adatbázisban, melyből 1-1 sor az adatbázisban fog 1-1 objektum példányt jelenteni.
- <strong>Dao</strong> definiálása, melyben definiáljuk, hogy 1-1 entitáson milyen műveleteink vannak.
- <strong>RoomDatabase</strong> osztályból leszármazás, melyen definiáljuk az entitiásainkat és azokhoz tartozó Dao osztályainkat
- <strong>Platform specifikus kódrészek</strong> implementálása a Room inicializálásához.</p>
<p>Először hozzuk létre az entitásunkat a közös kódban a <em>data/database/entity</em> (<em>hu.bme.aut.data.database.entity</em>) packagen belül az alábbi tartalommal:</p>
<p><code>MovieEntity.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Entity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.PrimaryKey</span>

<span class="nd">@Entity</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MovieEntity</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">posterPath</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">onWatchlist</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
Ahogy látható, a <strong>Room-ból</strong> származó Annotációkkal van kiegészítve egy kotlin data class, mely által a <strong>Room Compiler</strong> tudni fogja, hogy az adott entitást kell használnia. Továbbá nem szeretnénk, hogy a <strong>Room</strong> automatikusan generálja és kezelje az adott filmek elsődleges kulcsát (<em>PrimaryKey</em> annotáció), hanem a külső API által kapott id-val fogjuk lokálisan elmenteni az egyes filmeket.</p>
<p>A database packagen belül hozzunk létre egy <code>MovieDatabase.kt</code> fájlt az alábbi tartalommal.</p>
<p><code>MovieDatabase.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.entity.MovieEntity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="nd">@Database</span><span class="p">(</span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">MovieEntity</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="nd">@ConstructedBy</span><span class="p">(</span><span class="n">AppDatabaseConstructor</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MovieDatabase</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getDao</span><span class="p">():</span><span class="w"> </span><span class="n">MyMoviesDao</span>
<span class="p">}</span>

<span class="nd">@Suppress</span><span class="p">(</span><span class="s">&quot;NO_ACTUAL_FOR_EXPECT&quot;</span><span class="p">)</span>
<span class="kd">expect</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="nc">AppDatabaseConstructor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RoomDatabaseConstructor</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">initialize</span><span class="p">():</span><span class="w"> </span><span class="n">MovieDatabase</span>
<span class="p">}</span>

<span class="nd">@Dao</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">MyMoviesDao</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="n">onConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnConflictStrategy</span><span class="p">.</span><span class="na">IGNORE</span><span class="p">)</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="n">MovieEntity</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">$</span><span class="n">MOVIE_ENTITY</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllAsFlow</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">MovieEntity</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">$</span><span class="n">MOVIE_ENTITY</span><span class="s"> WHERE id = :id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getMovieById</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">MovieEntity?</span>

<span class="w">    </span><span class="nd">@Delete</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">toMovieEntity</span><span class="p">:</span><span class="w"> </span><span class="n">MovieEntity</span><span class="p">)</span>

<span class="w">    </span><span class="n">companion</span><span class="w"> </span><span class="n">object</span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">MOVIE_ENTITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MovieEntity&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Itt is a <em>Room</em> által biztosítótt annotációkkal látjuk el a <strong>MovieDatabase</strong> osztályunkat, ami esetünkben most egy absztrakt osztály lesz. Itt a Compiler az implementációt létrehozza a háttérben fordítási időben. Az AppDataBaseConstuctor esetén pedig az adott platformhoz tartozó initilize methodot is generálja nekünk.</p>
<p>A <strong>MyMoviesDao</strong> interfészben definiáljuk, hogy az adatbázisunkon milyen műveleteket tudunk végrehajtani.  Láthatjuk, hogy jelenleg beszúrni, minden adatot lekérdezni, egy adott film adatait olvasni, illetve törölni tudunk.</p>
<p>Bővítsük most ki a DI megoldásunkat a Room számára szükséges modullal is. Hozzunk létre egy <code>DataBaseModule.kt</code> fájlt a di package-en belül, az alábbi tartalommal.</p>
<p><code>DataBaseModule.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.RoomDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MovieDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MyMoviesDao</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.di.PlatformParameters</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.Module</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">expect</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">databaseBuilder</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">dataBaseModule</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">):</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">includes</span><span class="p">(</span>
<span class="w">        </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">single</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">databaseBuilder</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">single</span><span class="o">&lt;</span><span class="n">MyMoviesDao</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">get</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="p">().</span><span class="na">getDao</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">DB_FILE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mymovies.db&quot;</span>
</code></pre></div></p>
<p>Room esetén kissé bonyolultabb megoldást kell alkalmaznunk az adatbázis létrehozásakor. Ez azért van, mert egyes platformok esetén Platform specifikus adatokra is szükség lehet az adatbázis létrehozásakor (pl. Android esetén az android <em>context</em>). Ez jelen esetben egy <strong>PlatformParameters</strong> osztályban lesz elrejtve, ezáltal a lehető legtöbb kódot lehet a közös kódban implementálni. Ezen felül deklarálunk egy databaseBuilder <em>expect</em> függvényt is, amely a Room adatbázis platform-specifikus inicializálásáért lesz felelős.</p>
<p>Hozzunk létre egy <strong>PlatformParameters</strong> osztályt a di package-en belül az alábbi tartalommal.</p>
<p><code>PlatformParameters.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.Module</span>

<span class="kd">expect</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PlatformParameters</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getModule</span><span class="p">():</span><span class="w"> </span><span class="n">Module</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Egy expect classt használunk, vagyis minden platformnak szolgáltatnia kell egy megfelelő osztályt, amely képes visszaadni az adott platformon a megfelelő Koin modult.</p>
<p>Jelen esetben erre csak Androidon van szükségünk, ezért ezen kívül üres modult fog visszaadni a Desktop és IOS implementáció. Android esetén pedig a paraméterként átvett context-et szolgáltatjuk a modul paramétereként.</p>
<p><code>PlatformParameters.desktop.kt</code> és <code>PlatformParameters.ios.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.Module</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PlatformParameters</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getModule</span><span class="p">():</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><code>PlatformParameters.android.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">android.content.Context</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.Module</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PlatformParameters</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Context</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getModule</span><span class="p">():</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">single</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">context</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ha ezzel megvagyunk, akkor létrehozthatjuk a platform specifikus implementációit a <em>databaseBuilder</em> függvénynek.</p>
<p><code>DatabaseBuilder.android.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Room</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.RoomDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.sqlite.driver.bundled.BundledSQLiteDriver</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MovieDatabase</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">databaseBuilder</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">):</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dbFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platformParameters</span><span class="p">.</span><span class="na">context</span><span class="p">.</span><span class="na">getDatabasePath</span><span class="p">(</span><span class="n">DB_FILE_NAME</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Room</span><span class="p">.</span><span class="na">databaseBuilder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platformParameters</span><span class="p">.</span><span class="na">context</span><span class="p">.</span><span class="na">applicationContext</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbFile</span><span class="p">.</span><span class="na">absolutePath</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setDriver</span><span class="p">(</span><span class="n">BundledSQLiteDriver</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ahogy látható az adatbázis létrehozásához szükséges az android application context, az adatbázis driverjének pedig a <em>BundledSQLiteDriver</em>-t használjuk, a többi két platformon is.</p>
<p><code>DatabaseBuilder.desktop.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Room</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.RoomDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.sqlite.driver.bundled.BundledSQLiteDriver</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MovieDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.io.File</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">databaseBuilder</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">):</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dbFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;java.io.tmpdir&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">DB_FILE_NAME</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Room</span><span class="p">.</span><span class="na">databaseBuilder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbFile</span><span class="p">.</span><span class="na">absolutePath</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setDriver</span><span class="p">(</span><span class="n">BundledSQLiteDriver</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p><code>DatabaseBuilder.ios.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Room</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.RoomDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.sqlite.driver.bundled.BundledSQLiteDriver</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MovieDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">platform.Foundation.NSHomeDirectory</span>

<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">databaseBuilder</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">):</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dbFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSHomeDirectory</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DB_FILE_NAME</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Room</span><span class="p">.</span><span class="na">databaseBuilder</span><span class="o">&lt;</span><span class="n">MovieDatabase</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbFile</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setDriver</span><span class="p">(</span><span class="n">BundledSQLiteDriver</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Most már csak a DI app moduljába kell felvennük a database modult és kiegészíteni a hívás láncot, hogy mindegyik platform, mikor inicializálja a koin-t, átadjon egy PlatformParatmeters példányt is paraméterként.</p>
<p><code>AppModule.kt</code>:
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">appModule</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">includes</span><span class="p">(</span>
<span class="w">        </span><span class="n">dataBaseModule</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">),</span>
<span class="w">        </span><span class="n">dataModule</span><span class="p">(),</span>
<span class="w">        </span><span class="n">viewModelModule</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">initializeKoin</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">:</span><span class="w"> </span><span class="n">PlatformParameters</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startKoin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">modules</span><span class="p">(</span><span class="n">appModule</span><span class="p">(</span><span class="n">platformParameters</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Desktop és IOS platformon elég csak létrehozni egy PlatformParameters példányt, és azt átadni paraméterként. Android esetén a platform paramétereként a <em>contextet</em> is át kell adnunk. Mivel ezt a MainActivity-ben tesszük meg, az activity saját magát, vagyis <em>this</em>-t szolgáltatja paraméterként.</p>
<p><code>MainActivity.kt</code>:
<div class="highlight"><pre><span></span><code><span class="n">initializeKoin</span><span class="p">(</span><span class="n">PlatformParameters</span><span class="p">(</span><span class="k">this</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">elég</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">mert</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">contextban</span><span class="w"> </span><span class="n">vagyunk</span><span class="p">.</span>
</code></pre></div></p>
<p>Ezzel elkészültünk a DI kiegészítésével. A következő lépés az adatbázis bekötése lesz a <strong>MovieRepositoryba</strong>.</p>
<p>Ahogyan azt a DTO -&gt; domain Movie mappingnél láttuk, hasonlóan szükségünk lesz a MovieEntity-ből domain Movie modellre és vissza irányú  mappelésre is.</p>
<p>Egészítsük ki a <code>MovieMapper.kt</code> fájlt az alábbi sorokkal.</p>
<p><code>MovieMapper.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.entity.MovieEntity</span>

<span class="kd">fun</span><span class="w"> </span><span class="n">MovieEntity</span><span class="p">.</span><span class="nf">toMovieDomain</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Movie</span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">posterPath</span><span class="p">,</span><span class="w"> </span><span class="n">onWatchlist</span>
<span class="p">)</span>

<span class="kd">fun</span><span class="w"> </span><span class="n">Movie</span><span class="p">.</span><span class="nf">toMovieEntity</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MovieEntity</span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="n">posterPath</span><span class="p">,</span><span class="w"> </span><span class="n">onWatchlist</span>
<span class="p">)</span>
</code></pre></div></p>
<p>Bővítsük ezután a <strong>MovieRepositoryImpl</strong> osztályunkat az adatbázisban tárolt filmekre való feliratkozás, illetve a filmek adatbázisba való hozzáadás és abból való törlés műveleteinek megvalósításaival, melyhez a korábban elkészített MyMoviesDao-t használjuk fel.</p>
<p><code>MovieRepositoryImpl.kt</code>:
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.database.MyMoviesDao</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.mapper.toMovieEntity</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MovieRepositoryImpl</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tMDBApiClient</span><span class="p">:</span><span class="w"> </span><span class="n">TMDBApiClient</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">moviesDao</span><span class="p">:</span><span class="w"> </span><span class="n">MyMoviesDao</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MovieRepository</span><span class="w"> </span><span class="p">{</span>

<span class="p">...</span>

<span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">storedMovies</span><span class="p">()</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">moviesDao</span><span class="p">.</span><span class="na">getAllAsFlow</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movieEntities</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">movieEntities</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">toMovieDomain</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addMovieToWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">moviesDao</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">onWatchlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">).</span><span class="na">toMovieEntity</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">removeMovieFromWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">moviesDao</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">toMovieEntity</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Láthatjuk, hogy a WatchList-re való helyezés esetünkben nem jelent mást, mint a lokális adatbázisunkba való felvételt, amely filmeket egy külön képernyőn tekinthetjük majd meg.</p>
<p>Ezzel majdnem készen vagyunk már, arra van még szükség, hogy a felhasználói felületen jelenítsünk meg a filmeken egy hozzáadó / törlő gombot is, amelyekkel figyelőlistára helyezhetjük, illetve eltávolíthajuk onnan az adott filmet attól függően, hogy rajta van-e már.</p>
<p>Ennek implementációjára 2 alapvető lehetőségünk van.</p>
<p>Az első, hogy minden képernyő ViewModelje propagálja ezeket a műveleteket a repository függvényei felé, majd egy lambda paraméterként átadjuk azokat az egyes film kártyáknak.</p>
<p>Rövid egyszerűsített kód példának:
 ```kotlin
class ScreenAViewModel(private val repository: Repository) {
    fun addMovieToWatchList(movie: Movie) {
        repository.addMovieToWatchList(movie)
    }
}</p>
<p>class ScreenBViewModel(private val repository: Repository) {
    fun addMovieToWatchList(movie: Movie) {
        repository.addMovieToWatchList(movie)
    }
}</p>
<p>@Composable
fun ScreenA(viewModel: ScreenAViewModel) {
    val movies by viewModel.movies.collectAsStateWithLifecycle()</p>
<div class="highlight"><pre><span></span><code>LazyColumn {
    items(movies) { movie -&gt;
        MovieCard(
            movie = movie,
            addToWatchList = { viewModel.addMovieToWatchList(movie) }
        )
    }
}
</code></pre></div>
<p>}</p>
<p>@Composable
fun ScreenB(viewModel: ScreenBViewModel) {
    val movies by viewModel.movies.collectAsStateWithLifecycle()</p>
<div class="highlight"><pre><span></span><code>LazyColumn {
    items(movies) { movie -&gt;
        MovieCard(
            movie = movie,
            addToWatchList = { viewModel.addMovieToWatchList(movie) }
        )
    }
}
</code></pre></div>
<p>}
 ```
 Ezzel a megoldással az a probléma, hogy láthatóan kódduplikáció jelenik meg. Erre megoldás lehetne, ha egy ős ViewModelbe raknánk a közös függvényeket, de akkor minden képernyőn, ahol a hozzáadás és törlés tulajdonsága kell a kártyának, a MovieCard lambdáinak  külön kellene átadni a ViewModel függvényeit.</p>
<p>A másik megközelítésben a képernyők kizárólag a MovieCard-ok megjelenítéséért felelnek, és a filmekhez kapcsolódó műveletek logikáját egy külön MovieCardViewModel-be helyezzük. Ezáltal csökkentjük a képernyők kódbeli összetettségét, miközben jobban elkülönítjük a függőségeket. Ez a megközelítés elősegíti a komponensek újrafelhasználhatóságát és egyszerűsíti a kódunk karbantarthatóságát is. Hasonló elvet követ a <a href="https://github.com/arkivanov/Decompose">Decompose</a> könyvtár is, amely lehetővé teszi a UI-elemek életciklusának és adatkezelésének függetlenítését a környező komponensektől. Célszerű tehát ezt a megoldást választanunk.</p>
<p>Hozzuk létre tehát a <code>MovieCardViewModel.kt</code>-t a MovieCard mellett (a <em>hu.bme.aut.ui.feature.movie</em> packageben).
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.data.repository.MovieRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MovieCardViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">movieRepository</span><span class="p">:</span><span class="w"> </span><span class="n">MovieRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addToWatchlist</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movieRepository</span><span class="p">.</span><span class="na">addMovieToWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">removeFromWatchlist</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">movieRepository</span><span class="p">.</span><span class="na">removeMovieFromWatchList</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Szükséges még kiegészíteni a MovieCard composable-t a hozzátartozó ViewModel-el, továbbá a hozzáadás/törlésért felelős UI elemekkel.
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.shape.CircleShape</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Add</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Delete</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.draw.clip</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil3.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.domain.model.Movie</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.viewmodel.koinViewModel</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">MovieCard</span><span class="p">(</span>
<span class="w">    </span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">Movie</span><span class="p">,</span><span class="w"> </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">MovieCardViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinViewModel</span><span class="p">(),</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Box</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Card</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">elevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CardDefaults</span><span class="p">.</span><span class="na">cardElevation</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">posterPath</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movie</span><span class="p">.</span><span class="na">posterPath</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Poster for </span><span class="si">${</span><span class="n">movie</span><span class="p">.</span><span class="na">title</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">200.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">title</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">IconButton</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">clip</span><span class="p">(</span><span class="n">CircleShape</span><span class="p">).</span><span class="na">background</span><span class="p">(</span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">primary</span><span class="p">),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">onWatchlist</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">removeFromWatchlist</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">addToWatchlist</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">onWatchlist</span><span class="p">)</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Delete</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Add</span><span class="p">),</span>
<span class="w">                </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">onWatchlist</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;Remove from Watchlist&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;Add to Watchlist&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">tint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">onPrimary</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ne felejtsük el kiegészíteni a Dependency Injection megoldásunkat se: a ViewModel modulba vegyük fel a MovieCardViewModel-t is.
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.feature.movie.MovieCardViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.ui.feature.search.SearchScreenViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">viewModelModule</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SearchScreenViewModel</span><span class="p">(</span><span class="k">get</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">viewModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MovieCardViewModel</span><span class="p">(</span><span class="k">get</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Jelen állapotban indítható az alkalmazásunk és sikeresen mentődnek a filmek az adatbázisban, viszont a felhasználói felületen nem látjuk, hogy az elemek frissülnének, vagyis a hozzáadás gomb után törlés gombnak kéne megjelennie, majd törlés után újra a hozzáadásnak. Ez azért van, mert a UI-on lévő elemek az API hívás közvetlen eredményét mutatják és nincsenek vizsgálva, melyek vannak eltárolva az adatbázisban. Ez könnyen orvosolható már a repository rétegben.</p>
<p>Először vegyünk fel egy segédfüggvényt, mely megkapja az API hívás eredményét, továbbá az adatbázisban tárolt filmek listáját. Ha ID alapján megtaláljuk az adott filmet, akkor az onWatchList értékét beállítjuk logikai igazra.</p>
<p><code>MovieRepositoryImpl.kt</code>:
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateMovieResult</span><span class="p">(</span><span class="n">searchResult</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">storedMovies</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">storedMovieIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storedMovies</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="p">}.</span><span class="na">toSet</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">searchResult</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">            </span><span class="n">onWatchlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">storedMovieIds</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>A SearchMoviesViewModel jelen pillanatban a movieResultFlow-ra van feliratkozva, vagyis annak a változására történik recomposition a UI-on. Hasonlóan szükség lenne az adatábázis flow-ra történő feliratkozásra is, hogy az adatbázisban tárolt filmek változása esetén is frissüljön a SearchScreen. Erre nyújt megoldást a <strong>combine()</strong> nyelvi elem, mely 2 flowt alakít át egy flow-vá, és együttesen figyeli mindkettőt.</p>
<p>Változtassuk meg a <strong>getMovies()</strong> függvényt, mely már a <em>combinet</em> és a segédfüggvényt is alkalmazza.
<div class="highlight"><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getMovies</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">combine</span><span class="p">(</span><span class="n">movieResultFlow</span><span class="p">,</span><span class="w"> </span><span class="n">storedMovies</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">searchResult</span><span class="p">,</span><span class="w"> </span><span class="n">storedMovies</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">updateMovieResult</span><span class="p">(</span><span class="n">searchResult</span><span class="p">,</span><span class="w"> </span><span class="n">storedMovies</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div></p>
<p>Fordítsuk és indítsuk el az alkalmazásunkat desktop és mobilos platformon is! Mostmár működnie kell a hozzáadás és a törlés gomb változásainak is.</p>
<p><a class="glightbox" href="assets/add_delete_on_cards.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Add delete on cards" src="assets/add_delete_on_cards.png" /></a></p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készítsünk egy <strong>képernyőképet</strong>, amelyen az elindított alkalmazás SearchScreen látszik desktopon és mobil platformon egymás mellett! Legyen olyan film is, amelyiken a hozzáadás gomb látszik, és olyan is, amelyiken a törlés gomb! A kép a megoldásban a repositoryban f3.png néven szerepeljen!</p>
</div>
<h2 id="onallo-feladat-watchlist-kepernyo-implementalasa-1-pont">Önálló feladat - Watchlist képernyő implementálása (1 pont)<a class="headerlink" href="#onallo-feladat-watchlist-kepernyo-implementalasa-1-pont" title="Permanent link">&para;</a></h2>
<p>Valósítsuk meg a WatchList képernyőt is! Egészítsük ki az alkalmazást úgy, hogy a Watchlist képernyőn csak az adatbázisban tárolt filmek jelenjenek meg!</p>
<details class="tip">
<summary>Segítség</summary>
<p>A megoldás menete vázlatosan a SearchScreen-hez hasonló:</p>
<ol>
<li>Hozzuk létre és valósítsuk meg a WatchListScreen képernyő felületét! Használjuk fel a korábban létrehozott MovieCard composable függvényünket!</li>
<li>Ha igényesek akarunk lenni, kövessük a SearchScreen-nél használt megközelítést, miszerint desktopon táblázatos, mobilon pedig listás megjelenítést használjunk!</li>
<li>Hozzuk létre és valósítsuk meg a WatchListViewModel-t! Használjuk fel azt a WatchListScreen-ben!</li>
<li>A ViewModel-ben használjuk fel a Repository szükséges szolgáltatásait!</li>
<li>Egészítsük ki a DI ViewModel modulját az új ViewModel-el!</li>
<li>Cseréljük ki a placeholder Text-et az App belépési pointján a WatchListScreenünkre!</li>
</ol>
</details>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készítsünk egy <strong>képernyőképet</strong>, amelyen az elindított alkalmazás WatchListScreen képernyője látszik tetszőleges platformon! A képernyőn pontosan azok a filmek legyenek csak megjelenítve, amelyeket szerepelnek az adatbázisban. A kép a megoldásban a repositoryban f4.png néven szerepeljen!</p>
</div>
<details>
  <summary>📱 Kiegészítés - MacOs eszköz szükséges</summary>

  Amennyiben van rá lehetőségünk, próbáljuk ki az alkalmazást iOS platformon! Miután sikeresen lefordult az alkalmazás Android és Desktop platformon, nézzük meg, hogyan jelenik meg iOS-en.

  Ehhez Xcode-ban szükséges megnyitni az `iosApp` könyvtárat, majd a **Build** gombra kattintani egy kiválasztott iPhone szimulátoron.   Ha mindent megfelelően csináltunk, egy funkcionalitásban megegyező alkalmazásunk lesz a többi platformmal.

  ![iOS](assets/ios.png)

</details>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2025. április 26. 21:29:06">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="2025. április 26. 21:29:06"><span class="timeago" datetime="2025-04-26T21:29:06+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025. április 26. 21:29:06">2025-04-26</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Vissza a tetejére
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.code.copy"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>