
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ekler Péter, Gazdi László, Pásztor Dániel, Somogyi Norbert Zsolt">
      
      
      
        <link rel="prev" href="../lab3/">
      
      
        <link rel="next" href="../../hf/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.14">
    
    
      
        <title>Labor 4 - Adaptív UI, platformspecifikus kód és clean architecture - BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labor-4-adaptiv-ui-platformspecifikus-kod-es-clean-architecture" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" class="md-header__button md-logo" aria-label="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Labor 4 - Adaptív UI, platformspecifikus kód és clean architecture
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/viaubxav084/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav084/laborok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Tudnivalók
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../lab_1/" class="md-tabs__link md-tabs__link--active">
        Laborok
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hf/" class="md-tabs__link">
        Házi feladat
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" class="md-nav__button md-logo" aria-label="BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUBXAV084 - Kotlin Multiplatform alapú szoftverfejlesztés laborfeladatok
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/viaubxav084/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav084/laborok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Tudnivalók
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tudnivalók
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tárgy ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/contributing/" class="md-nav__link">
        Hozzájárulás az anyaghoz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab_1/" class="md-nav__link">
        Labor 1 - Kotlin Multiplatform alapok, környezet megismerése
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab_2/" class="md-nav__link">
        Labor 2 - Egyszerű felhasználói felület fejlesztése Kotlin Multiplatformon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        Labor 3 - Hálózati kommunikáció és adatkezelés
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labor 4 - Adaptív UI, platformspecifikus kód és clean architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labor 4 - Adaptív UI, platformspecifikus kód és clean architecture
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#felhasznalt-technologiak" class="md-nav__link">
    Felhasznált technológiák:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-alkalmazas-specifikacioja" class="md-nav__link">
    Az alkalmazás specifikációja
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projekt-megnyitasa" class="md-nav__link">
    Projekt megnyitása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-domain-reteg" class="md-nav__link">
    A domain réteg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adateleresi-reteg" class="md-nav__link">
    Adatelérési réteg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-termeklista-felulet-kialakitasa-1-pont" class="md-nav__link">
    A terméklista felület kialakítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A terméklista felület kialakítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intent" class="md-nav__link">
    Intent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewmodel" class="md-nav__link">
    ViewModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View
  </a>
  
    <nav class="md-nav" aria-label="View">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#termek-kartya" class="md-nav__link">
    Termék kártya
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-lista-panel" class="md-nav__link">
    A lista panel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-reszletes-panel" class="md-nav__link">
    A részletes panel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-kereso-oldal" class="md-nav__link">
    A kereső oldal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuggoseginjektalas" class="md-nav__link">
    Függőséginjektálás
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uj-termek-felvetele-1-pont" class="md-nav__link">
    Új termék felvétele ( 1 pont)
  </a>
  
    <nav class="md-nav" aria-label="Új termék felvétele ( 1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prezentacios-reteg" class="md-nav__link">
    Prezentációs réteg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigacio" class="md-nav__link">
    Navigáció
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-picker" class="md-nav__link">
    File picker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-felhasznalokezeles-megvalositasa-1-pont" class="md-nav__link">
    A felhasználókezelés megvalósítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A felhasználókezelés megvalósítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-authentikacios-felulet" class="md-nav__link">
    Az authentikációs felület
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-profil-felulet" class="md-nav__link">
    A profil felület
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-navigacio" class="md-nav__link">
    A navigáció
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-bejelentkezes-fuggo-hozzaadas-gomb-1-pont" class="md-nav__link">
    Önálló feladat - Bejelentkezés függő hozzáadás gomb (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-lokalizacio-tamogatasa-1-pont" class="md-nav__link">
    Önálló feladat - Lokalizáció támogatása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Házi feladat
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Házi feladat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/" class="md-nav__link">
        Házi feladat információk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#felhasznalt-technologiak" class="md-nav__link">
    Felhasznált technológiák:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-alkalmazas-specifikacioja" class="md-nav__link">
    Az alkalmazás specifikációja
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projekt-megnyitasa" class="md-nav__link">
    Projekt megnyitása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-domain-reteg" class="md-nav__link">
    A domain réteg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adateleresi-reteg" class="md-nav__link">
    Adatelérési réteg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-termeklista-felulet-kialakitasa-1-pont" class="md-nav__link">
    A terméklista felület kialakítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A terméklista felület kialakítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intent" class="md-nav__link">
    Intent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewmodel" class="md-nav__link">
    ViewModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View
  </a>
  
    <nav class="md-nav" aria-label="View">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#termek-kartya" class="md-nav__link">
    Termék kártya
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-lista-panel" class="md-nav__link">
    A lista panel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-reszletes-panel" class="md-nav__link">
    A részletes panel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-kereso-oldal" class="md-nav__link">
    A kereső oldal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuggoseginjektalas" class="md-nav__link">
    Függőséginjektálás
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uj-termek-felvetele-1-pont" class="md-nav__link">
    Új termék felvétele ( 1 pont)
  </a>
  
    <nav class="md-nav" aria-label="Új termék felvétele ( 1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prezentacios-reteg" class="md-nav__link">
    Prezentációs réteg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigacio" class="md-nav__link">
    Navigáció
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-picker" class="md-nav__link">
    File picker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-felhasznalokezeles-megvalositasa-1-pont" class="md-nav__link">
    A felhasználókezelés megvalósítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A felhasználókezelés megvalósítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-authentikacios-felulet" class="md-nav__link">
    Az authentikációs felület
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-profil-felulet" class="md-nav__link">
    A profil felület
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-navigacio" class="md-nav__link">
    A navigáció
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-bejelentkezes-fuggo-hozzaadas-gomb-1-pont" class="md-nav__link">
    Önálló feladat - Bejelentkezés függő hozzáadás gomb (1 pont)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-lokalizacio-tamogatasa-1-pont" class="md-nav__link">
    Önálló feladat - Lokalizáció támogatása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="labor-4-adaptiv-ui-platformspecifikus-kod-es-clean-architecture">Labor 4 - Adaptív UI, platformspecifikus kód és clean architecture<a class="headerlink" href="#labor-4-adaptiv-ui-platformspecifikus-kod-es-clean-architecture" title="Permanent link">&para;</a></h1>
<h2 id="bevezeto">Bevezető<a class="headerlink" href="#bevezeto" title="Permanent link">&para;</a></h2>
<p>A labor során egy apróhirdetés alkalmazást fogunk készíteni Android és Windows platformokra. Az alkalmazásban lehetőség van apróhirdetéseket böngészni, és bejelentkezés után sajátot is közzétenni. A perzisztens tárolás megvalósítása nem része a jelenlegi anyagnak, azonban a projekt felépítésében, architektúrájában kiemelt figyelmet fordítunk arra, hogy ez a későbbiekben nagyon könnyen implementálható legyen. A felületet adaptítv eszközökkel fogjuk elkészíteni, hogy minden környezetben megfelelően nézzen ki. </p>
<h2 id="felhasznalt-technologiak">Felhasznált technológiák:<a class="headerlink" href="#felhasznalt-technologiak" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-viewmodel.html"><code>ViewModel</code></a>  </li>
<li><a href="https://insert-koin.io/docs/reference/koin-mp/kmp/"><code>Koin</code></a>   </li>
<li><a href="https://github.com/coil-kt/coil"><code>Coil</code></a></li>
<li><a href="https://ktor.io/docs/client-create-multiplatform-application.html"><code>Ktor</code></a></li>
<li><a href="https://developer.android.com/develop/ui/compose/layouts/adaptive/list-detail"><code>Adaptive Layout</code></a></li>
<li><a href="https://developer.android.com/develop/ui/compose/layouts/adaptive/build-adaptive-navigation"><code>Adaptive Navigation</code></a></li>
</ul>
<h2 id="az-alkalmazas-specifikacioja">Az alkalmazás specifikációja<a class="headerlink" href="#az-alkalmazas-specifikacioja" title="Permanent link">&para;</a></h2>
<p>Az alkalmazás navigációs menüjében két elem látható. A Kereső felületen az apróhirdetések listája található. Egy hirdetésre kattintáskor megjelenik a részletes nézete, képernyőméret függvényében a lista mellett vagy külön oldalon. A navigáció másik eleme a Profil oldal, ahol lehetőség van be- és kijelentkezésre. Ha a felhasználó bejelentkezett, akkor a lista oldalon lehetősége van új hirdetést feladni. Ehhez egy külön felület nyílik meg ahol az adatok megadása mellett kép is csatolható.</p>
<p>Fontos funkció, hogy a felhasználói felület a megjeleníthető mérettől függően adaptívan változik.</p>
<p align="center">
<a class="glightbox" href="./assets/mobile_list.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/mobile_list.png" width="240"></a>
<a class="glightbox" href="./assets/mobile_details.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/mobile_details.png" width="240"></a>
</p>
<p align="center">
<a class="glightbox" href="./assets/mobile_sign_in.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/mobile_sign_in.png" width="240"></a>
<a class="glightbox" href="./assets/mobile_file_picker.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/mobile_file_picker.png" width="240"></a>
</p>
<p align="center">
<a class="glightbox" href="./assets/desktop_list.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_list.png" width="240"></a>
<a class="glightbox" href="./assets/desktop_details.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_details.png" width="240"></a>
</p>
<p align="center">
<a class="glightbox" href="./assets/desktop_list2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_list2.png" width="360"></a>
<a class="glightbox" href="./assets/desktop_details2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_details2.png" width="360"></a>
</p>
<p align="center">
<a class="glightbox" href="./assets/desktop_list3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_list3.png" width="720"></a>
<a class="glightbox" href="./assets/desktop_file_picker.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/desktop_file_picker.png" width="720"></a>
</p>

<h2 id="elokeszuletek">Előkészületek<a class="headerlink" href="#elokeszuletek" title="Permanent link">&para;</a></h2>
<p>A feladatok megoldása során ne felejtsük el követni a <a href="../../tudnivalok/github/GitHub/">feladat beadás folyamatát</a>.</p>
<h3 id="git-repository-letrehozasa-es-letoltese">Git repository létrehozása és letöltése<a class="headerlink" href="#git-repository-letrehozasa-es-letoltese" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Moodle-ben keressük meg a laborhoz tartozó meghívó URL-jét és annak segítségével hozzuk létre a saját repositoryt.</p>
</li>
<li>
<p>Várjuk meg, míg elkészül a repository, majd checkout-oljuk ki.</p>
</li>
<li>
<p>Hozzunk létre egy új ágat <code>megoldas</code> néven, és ezen az ágon dolgozzunk.</p>
</li>
<li>
<p>A <code>neptun.txt</code> fájlba írjuk bele a Neptun kódunkat. A fájlban semmi más ne szerepeljen, csak egyetlen sorban a Neptun kód 6 karaktere.</p>
</li>
<li>
<p>Indítsuk el az Android Studio-t vagy az Intellij-t, majd nyissuk meg a kapott kezdőprojektet.</p>
</li>
<li>
<p>Ellenőrizzük, hogy a létrejött projekt lefordul és futtatható mobil és desktop platformokon.</p>
</li>
</ol>
<h3 id="projekt-megnyitasa">Projekt megnyitása<a class="headerlink" href="#projekt-megnyitasa" title="Permanent link">&para;</a></h3>
<p>Ezen a laboron nem új projektet fogunk létrehozni, hanem egy már létezőből indulunk ki, ez megtalálható a kicheckoutolt repositoryban <code>VIKted</code> néven. Nyissuk meg a projektet és nézzük át a felépítését.</p>
<p>A megnyitott projekt tartalmazza a labor során szükséges könyvtárakat és függőségeket a <code>libs.versions.toml</code> és a <code>build.gradle.kts</code> fájlokban. Ezen kívül elő van készítve benne a függőséginjektáláshoz a Koin, már csak a modulokat kell felvenni a megfelelő helyre. </p>
<p>Szintén szerepel a fájlok között a res/values mappában egy strings.xml fájl, ami az alkalmazásban használt szövegeket gyűjti össze. Fontos, hogy ezen a ponton mindenképpen lefordítsuk a projektet, ugyanis Kotlin Multiplatform esetén az erőforrások csak akkor állnak rendelkezésre, ha egyszer már lefordítottuk őket.</p>
<h2 id="a-domain-reteg">A domain réteg<a class="headerlink" href="#a-domain-reteg" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Domain réteg</p>
<p>A domain rétegben a projekt "technológiafüggetlen" része található, amelybe még nem vegyülnek a konkrét adattárolási technológiával vagy megjelenítéssel kapcsolatos részletek. Ezzel a közbülső réteggel az alkalmazásunk komponensei lazábban csatolttá válnak, és megkönnyítik, hogy kevés módosítással lecseréljük akár az adattárolásért felelős technológiánkat, akár a megjelenítést. Az itt megvalósított üzleti logika műveletek nem függenek közvetlen sem az adattárolástól, csak a reposiory komponensektől, és mivel a tennivalók független domainmodelljével dolgoznak, a megjelenítéstől is függetlenek. </p>
<p>Jelen esetben nem lesz komplex üzleti logikánk, így ez a réteg gyakorlatilag kimarad, csak a függőséginjektálás és a modellek kerülnek bele.</p>
</div>
<p>Először vegyük fel az adat osztályainkat. Mivel a teljes alkalmazáson belül ugyan azt az adat struktúrát fogjuk használni, ezért kerüljenek ezek a <code>hu.bme.aut.kmp.vikted.domain.model</code> <em>package</em>-be. Természetesen amennyiben az adattároláshoz vagy a megjelenítéshez más struktúrára lenne szükségünk, azokban a rétegekben is vehetünk fel model osztályokat, majd átkonvertálhatjuk őket a megfelelő formátumra. </p>
<p>A jelenlegi termékeinknek van id-ja, neve, leírása, ára, egy képe és tartoznak egy felhasználóhoz.</p>
<p><code>Product.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Product</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">price</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">imageUrl</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>Az egységes kezelés érdekében hozzunk létre egy felhasználó osztályt is ugyanide. Ennek jelenleg csak egy id mezője lesz, de később könnyen bővíthető egyéb adatokkal.</p>
<p><code>User.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="adateleresi-reteg">Adatelérési réteg<a class="headerlink" href="#adateleresi-reteg" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Repository minta</p>
<p>A Repository minta lényege, hogy az adatelérést absztracháljuk, vagyis leválasztjuk a konkrét megvalósításról, így növelve a kód karbantarthatóságát, tesztelhetőségét és fliexibilitását. Ezzel mind a konkrét adatelérésünk mind az üzleti logikánk fükketlenné válik és nem függenek egymástól.</p>
<p>Jelen helyzetben ezt úgy valósítjuk meg, hogy definiálunk egy <em>interface</em>-t, amin keresztül az adatainkat elérjük, majd ennek egy implementációja fogja végezni a valós adatmanipulációt.</p>
</div>
<p>Ez után készítsük el az adatelérési réteget a <code>hu.bme.aut.kmp.vikted.data</code> <em>package</em>-be. Itt a <em>Repository</em> mintát fogjuk követni. A termékekkel kapcsolatos <em>repository</em> kerüljön a <code>product</code> <em>package</em>-be:</p>
<p><code>IProductRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">IProductRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">products</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getProduct</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Product?</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addProduct</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Láthatjuk, hogy a termékeink listáját egy <em>Flow</em>-ban kapjuk vissza, illetve van néhány adatmanipulációs függvényünk is.</p>
<p>Készítsuk most el ennek az <em>interface</em>-nek egy konkrét megvalósítását, ami memóriában fogja tárolni az adatainkat. </p>
<p><code>MemoryProductRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MemoryProductRepository</span><span class="p">(</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IProductRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">productStateFlow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">emptyList</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="p">())</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">productList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">toMutableList</span><span class="p">()</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eladó használt laptop&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">89900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Használt, de jó állapotú laptop eladó. 15,6 hüvelykes kijelző, Intel Core i5 processzor, 8GB RAM, 256GB SSD. Ideális mindennapi használatra, tanuláshoz vagy munkához. Az akkumulátor is hosszú ideig bírja. Kérésre képeket tudok küldeni.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://plus.unsplash.com/premium_photo-1681160405580-a68e9c4707f9?q=80&amp;w=1965&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eladó új DSLR fényképezőgép&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">199900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Új Canon EOS 90D DSLR fényképezőgép, 32.5 MP, 4K videófelvétel, 10 kép/mp sorozatfelvétel. Ideális kezdő és profi fotósoknak. Kit objektívvel és memóriakártyával együtt.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://images.unsplash.com/photo-1621958054700-7af166501105?q=80&amp;w=2070&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Új okostelefon&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">129900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Frissen vásárolt, bontatlan okostelefon eladó. 6,5 hüvelykes OLED kijelző, 128GB tároló, 48MP kamera. Még garanciális, eredeti dobozában. Nagyszerű választás azoknak, akik szeretnék frissíteni a készüléküket.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://images.unsplash.com/photo-1598965402089-897ce52e8355?q=80&amp;w=1936&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Kávéfőző&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Új, sosem használt kávéfőző eladó. 15 bar nyomású, gyorsan készíti el a tökéletes eszpresszót. Kiváló minőségű, rozsdamentes acél burkolat, és egyszerű kezelhetőség. Ideális választás minden kávérajongónak. Még a gyári garancia is érvényes rá.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://images.unsplash.com/photo-1565452344518-47faca79dc69?q=80&amp;w=1935&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eladó új Bluetooth fejhallgató&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">29900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Új Bluetooth fejhallgató, sztereó hangzás, aktív zajszűrés. Kényelmes, állítható pánttal, hosszú akkumulátor élettartammal. Kiváló választás sportolóknak vagy utazóknak.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://images.unsplash.com/photo-1631281637573-14de1a1968fd?q=80&amp;w=1990&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bicikli eladó&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Kiváló állapotú férfi városi bicikli eladó. 28 hüvelykes kerekek, Shimano váltó, kényelmes, puha ülés. Tökéletes a mindennapi közlekedéshez a városban. Alig használt, a fékek és váltók tökéletesen működnek.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://plus.unsplash.com/premium_photo-1678718713393-2b88cde9605b?q=80&amp;w=2070&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">Product</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eladó új okosóra&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">49900</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Új okosóra, 1.4 hüvelykes AMOLED kijelző, szívritmus monitor, alvásfigyelés, vízálló, kompatibilis Android és iOS készülékekkel. Modern dizájn, többféle színből választható.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://images.unsplash.com/photo-1632794716789-42d9995fb5b6?q=80&amp;w=2070&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">products</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span>
<span class="w">        </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getProduct</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Product? </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">firstOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addProduct</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">productList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">toMutableList</span><span class="p">()</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">removeAll</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">productList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">            </span><span class="n">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TODO&quot;</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productList</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">id</span><span class="p">)</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nb">it</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">adList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">toMutableList</span><span class="p">()</span>
<span class="w">        </span><span class="n">adList</span><span class="p">.</span><span class="na">removeAll</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">productStateFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adList</span><span class="p">.</span><span class="na">toList</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ez egy elég egyszerű megvalósítása az adattárolásnak, de szerencsére a <em>Repository minta</em> alkalmazása miatt bármikor könnyen lecserélhető mondjuk egy adatbázis alapú tárolásra. Észrevehetjük azt is, hogy a <em>userId</em> jelenleg nincsen megfelelően kezelve. Ezt egy későbbi lépésben, az authentikáció hozzáadásánál fogjuk módosítani.</p>
<h2 id="a-termeklista-felulet-kialakitasa-1-pont">A terméklista felület kialakítása (1 pont)<a class="headerlink" href="#a-termeklista-felulet-kialakitasa-1-pont" title="Permanent link">&para;</a></h2>
<p>A megjelenítési rétegben az MVI (Model-View-Intent) mintát fogjuk követni.</p>
<div class="admonition info">
<p class="admonition-title">MVI</p>
<p>Az MVI minta  lényege, hogy külön választja a megjelenítéskor használt adatokat (Model), a vizuális megjelenítést (View) és a interakciókat (Intent), ezzel sokkal rugalmasabbá téve a megjelenítési réteget. </p>
<p>Ez esetünkben az alábbi módon néz ki: Az adatainkat a ViewModelek fogják tárolni, méghozzá egy külön állapotban (Model). A felhasználói felületünk, amiket a <em>Composable</em>-ök alkotnak (View),  a ViewModel állapotát csak megfigyeli. A View függévényhívások helyett eseményeket küld a ViewModel felé (Intent), illetve onnan is csak eseményeket kap vissza direkt vezérlés helyett.</p>
</div>
<p>A terméklista valamint a részletes nézet szorosan összekapcsolódik, néhol egy felületen is lesz, így közös ViewModel-t készítünk neki.</p>
<h3 id="model">Model<a class="headerlink" href="#model" title="Permanent link">&para;</a></h3>
<p>Először készítsük el azt a modelt, ami a felületünk állapotát reprezentálja. A megjelenítési réteg forrását tegyük a <code>hu.bme.aut.kmp.vikted.presentation</code> <em>package</em>-be. Ezen belül a terméklista képernyő kerüljön a <code>screen.product.search</code> csomagba.</p>
<p><code>ProductSearchScreenState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductSearchScreenState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isLoading</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">products</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emptyList</span><span class="p">(),</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">selectedProduct</span><span class="p">:</span><span class="w"> </span><span class="n">Product? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>
</code></pre></div>
<p>A felületünk alapvetően három állapotban lehet: <em>Loading</em>, <em>Error</em>, <em>Result</em>. Ennek a reprezentációja látható a <code>ProductSearchScreenState</code> osztályban, ahol az, hogy éppen töltünk-e csak egy <em>Boolean</em> érték, viszont a hibához már tartozik üzenet is, ahogyan az eredményhez a <em>product</em> lista. Ezen kívül tároljuk a listából éppen kiválasztott terméket valamint a <em>userId</em>-t is.</p>
<h3 id="intent">Intent<a class="headerlink" href="#intent" title="Permanent link">&para;</a></h3>
<p>A felületünk felől a <em>ViewModel</em> felé jelenleg egyetlen interakció érkezhet, ami a termék kiválasztása. Ezeket az interakciókat egy <code>ProductSearchScreenEvent</code> osztályba foglaljuk össze.</p>
<p><code>ProductSearchScreenEvent.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductSearchScreenEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductSelected</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductSearchScreenEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">sealed class</p>
<p>A Kotlin sealed class-ai olyan osztályok, amelyekből korlátozott az öröklés, és fordítási időben minden leszármazott osztálya ismert. Ezeket az osztályokat az enumokhoz hasonló módon tudjuk alkalmazni. Jelen esetben a ProductSelected valójában nem a ProductSearchScreenEvent közvetlen leszármazottja, hanem anonim leszármazott osztálya, mivel a termék paraméterként történő kezelését is tartalmazza.</p>
</div>
<h3 id="viewmodel">ViewModel<a class="headerlink" href="#viewmodel" title="Permanent link">&para;</a></h3>
<p>A Model és a lehetséges Intentek ismeretében már össze tudjuk rakni a ViewModelünket.</p>
<p><code>ProductSearchViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.IProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">ProductSearchViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">productRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IProductRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">ProductSearchScreenState</span><span class="p">())</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">loadProducts</span><span class="p">()</span>
<span class="w">        </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TODO&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">ProductSearchScreenEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProductSearchScreenEvent</span><span class="p">.</span><span class="na">ProductSelected</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">selectProduct</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">product</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loadProducts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="n">productRepository</span><span class="p">.</span><span class="na">products</span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentSelected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">selectedProduct</span>
<span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                            </span><span class="n">isLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                            </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">products</span><span class="p">,</span>
<span class="w">                            </span><span class="n">selectedProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentSelected</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">selectProduct</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">selectedProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ProductSearchViewModel</code> egy privát <em>MutableStateFlow</em>-ban tartalmazza az imént létrehozott <code>ProductSearchScreenState</code> állapotot, és azt egy megfigyelhető formában a <em>View</em> rendelkezésére bocsájtja. Ezen kívül az init blokkban elvégzi az adatok belöltését a repository-ból, valamint az <code>onEvent</code> függvénnyel lekezeli a <em>View</em> felől érkező eseményt.</p>
<h3 id="view">View<a class="headerlink" href="#view" title="Permanent link">&para;</a></h3>
<p>A Model, az Intent és a ViewModel után már elkészíthetjük a View-t is.</p>
<h4 id="termek-kartya">Termék kártya<a class="headerlink" href="#termek-kartya" title="Permanent link">&para;</a></h4>
<p>A listában a termékeinket kártyákon fogjuk megjeleníteni. Mivel ezek univerzálisak, akár az alkalmazás több felületén is használhatóak lennének, külön <em>Composable</em>-ként fogjuk elkészíteni őket. A felhasználói felületet tegyük a <code>presentation</code> <em>package</em>-be. Ezen belül a kártyánk egy <code>components</code> csomagba kerüljön.</p>
<p><code>ProductCard.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.width</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Card</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.Color</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.layout.ContentScale</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.TextStyle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.font.FontWeight</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil3.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.painterResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.compose_multiplatform</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProductCard</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="p">,</span>
<span class="w">    </span><span class="n">backgroundColor</span><span class="p">:</span><span class="n">Color</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Card</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">        </span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">backgroundColor</span><span class="p">,</span>
<span class="w">        </span><span class="n">contentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">onBackground</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Column</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">                </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">fontWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontWeight</span><span class="p">.</span><span class="na">Bold</span><span class="p">,</span>
<span class="w">                    </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32.</span><span class="n">sp</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>

<span class="w">            </span><span class="n">Row</span><span class="p">(</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">                </span><span class="n">verticalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterVertically</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                        </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">imageUrl</span><span class="p">,</span>
<span class="w">                        </span><span class="n">placeholder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">painterResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">compose_multiplatform</span><span class="p">),</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentScale</span><span class="p">.</span><span class="na">Fit</span><span class="p">,</span>
<span class="w">                        </span><span class="n">clipToBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="m">160.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">80.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">LightGray</span><span class="p">),</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>

<span class="w">                </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">description</span><span class="p">,</span>
<span class="w">                    </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">                    </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">fontWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontWeight</span><span class="p">.</span><span class="na">Light</span><span class="p">,</span>
<span class="w">                        </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20.</span><span class="n">sp</span><span class="p">,</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">product</span><span class="p">.</span><span class="na">price</span><span class="si">}</span><span class="s"> Ft&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">                </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20.</span><span class="n">sp</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A termékhez tartozó kép megjelenítését a <code>Coil</code> könyvtárral oldjuk meg. Itt elég megadnunk a kép elérési útját (hálózatról, háttértárról vagy akár az erőforrások közül) és a könyvtár elvégzi az aszinkron betöltést. </p>
<p>Figyeljük meg, hogy hogyan használjuk az erőforrásainkat, hogyan hivatkozunk a <em>drawable</em> mappában lévő képi erőforrásra.</p>
<p>Látható, hogy a kártyánkat felkészítettük egy esetleges háttér szín változásra. Erre azért van szükségünk, mert a listánkban a bejelentkezett felhasználóhoz tartozó bejegyzéseket majd más színnel szeretnénk jelölni.</p>
<h3 id="a-lista-panel">A lista panel<a class="headerlink" href="#a-lista-panel" title="Permanent link">&para;</a></h3>
<p>Azt szeretnénk, hogy a felületünk a képernyő méretétől függően adaptívan, máshogy jelenjen meg. Ezért a listát és a részletes nézetet nem teljes <em>Screen</em>-ekként, hanem csak panelokként készítjük el, amik majd akár egymás mellett is megjelenhetnek.</p>
<p>Készítsük el tehát a lista panelt a <code>search.pane.list</code> <em>package</em>-ben.</p>
<p><code>ProductListPane.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.pane.list</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.clickable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.LazyColumn</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.items</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.CircularProgressIndicator</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.Color</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.components.ProductCard</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.ProductSearchScreenState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.some_error_message</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.text_empty_ad_list</span>

<span class="nd">@Preview</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProductListPane</span><span class="p">(</span>
<span class="w">    </span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">ProductSearchScreenState</span><span class="p">,</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">onListItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">Box</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">LightGray</span><span class="p">),</span>
<span class="w">        </span><span class="n">contentAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CircularProgressIndicator</span><span class="p">(</span>
<span class="w">                </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">onBackground</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">error</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">error</span><span class="o">?.</span><span class="na">message</span>
<span class="w">                    </span><span class="o">?:</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">some_error_message</span><span class="p">),</span>
<span class="w">                </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">onBackground</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">products</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">text_empty_ad_list</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="n">LazyColumn</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">products</span><span class="p">,</span>
<span class="w">                        </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">-&gt;</span>

<span class="w">                        </span><span class="n">ProductCard</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">clickable</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                    </span><span class="n">onListItemClick</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">product</span><span class="p">,</span>
<span class="w">                            </span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">userId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">product</span><span class="p">.</span><span class="na">userId</span><span class="p">)</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">secondary</span>
<span class="w">                            </span><span class="k">else</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">background</span>
<span class="w">                        </span><span class="p">)</span>

<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">products</span><span class="p">.</span><span class="na">last</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">product</span><span class="p">)</span>
<span class="w">                            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>

<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A lista panelünk megkapja az állapotot amit annak függvényében meg is jelenít. Ha <em>Loading</em> állapotban vagyunk, akkor egy <code>CircularProgressIndicator</code>-t mutatunk, ha <em>Error</em> állapotban vagyunk, akkor egy hibaüzenetet, ha pedig egyik sem, akkor megjelenítjük a listát a létrehozott <code>ProductCard</code>-okkal. Figyeljük meg, hogy a kártyák háttérszíne hogyan függ a userId-tól.</p>
<p>A <code>ProductListPane</code> átveszi az <code>onListItemClick</code> <em>callback</em>-et is, mivel egy termékre kattintásnál navigációnak kell történnie, amit "felülről" vezérelnek.</p>
<p>Figyeljük meg, hogy hogyan használjuk az erőforrásainkat, hogyan hivatkozunk a <em>values/strings.xml</em> fájlban lévő szöveges erőforrásra.</p>
<h3 id="a-reszletes-panel">A részletes panel<a class="headerlink" href="#a-reszletes-panel" title="Permanent link">&para;</a></h3>
<p>A lista panel után készítsük el a részletes panelt is a <code>pane.details</code> <em>package</em>-ben. Ez jóval egyszerűbb lesz, hiszen csak a megkapott <code>selectedProduct</code> adatait kell megjelenítenie.</p>
<p><code>ProductDetailsPane.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.pane.details</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.clickable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.rememberScrollState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.verticalScroll</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Card</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.SnackbarHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.SnackbarHostState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Surface</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.remember</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.rememberCoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.Color</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.layout.ContentScale</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.TextStyle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.font.FontWeight</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.style.TextAlign</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil3.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.getString</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.painterResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_buy</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.compose_multiplatform</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_product_description</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_product_name</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_product_price</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_products</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.text_not_yet</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.awt.SystemColor.text</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProductDetailsPane</span><span class="p">(</span>
<span class="w">    </span><span class="n">selectedProduct</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">snacbarHostState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">SnackbarHostState</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">localCoroutineScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberCoroutineScope</span><span class="p">()</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">snackbarHost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">SnackbarHost</span><span class="p">(</span><span class="n">snacbarHostState</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Column</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">verticalScroll</span><span class="p">(</span><span class="n">rememberScrollState</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">LightGray</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">weight</span><span class="p">(</span><span class="m">1f</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectedProduct</span><span class="p">.</span><span class="na">imageUrl</span><span class="p">,</span>
<span class="w">                    </span><span class="n">placeholder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">painterResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">compose_multiplatform</span><span class="p">),</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentScale</span><span class="p">.</span><span class="na">Fit</span><span class="p">,</span>
<span class="w">                    </span><span class="n">clipToBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">                </span><span class="p">)</span>

<span class="w">                </span><span class="n">Card</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_product_name</span><span class="p">))</span>

<span class="w">                        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectedProduct</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                            </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span>
<span class="w">                            </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                                </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20.</span><span class="n">sp</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">Card</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_product_price</span><span class="p">))</span>

<span class="w">                        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">selectedProduct</span><span class="p">.</span><span class="na">price</span><span class="si">}</span><span class="s"> Ft&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">                            </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                                </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20.</span><span class="n">sp</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">Card</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_product_description</span><span class="p">))</span>

<span class="w">                        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selectedProduct</span><span class="p">.</span><span class="na">description</span><span class="p">,</span>
<span class="w">                            </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                                </span><span class="n">fontWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontWeight</span><span class="p">.</span><span class="na">Light</span><span class="p">,</span>
<span class="w">                                </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20.</span><span class="n">sp</span><span class="p">,</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">Surface</span><span class="p">(</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">clickable</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">localCoroutineScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">snacbarHostState</span><span class="p">.</span><span class="na">showSnackbar</span><span class="p">(</span><span class="n">getString</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">text_not_yet</span><span class="p">))</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">primary</span><span class="p">,</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_buy</span><span class="p">),</span>
<span class="w">                    </span><span class="n">textAlign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextAlign</span><span class="p">.</span><span class="na">Center</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Figyeljük meg, hogy hogyan valósítottuk meg a vásárlás gombot a képernyő alján! Egy <em>Surface</em>-t helyeztünk el, amire kattintáskor egy <em>Snackbar</em> üzenet jelenik meg. Fontos megjegyezni, hogy a <em>Snackbar</em> nem érhető el a UI szálról, így egy külön korutinnal kell megoldanunk a használatát.</p>
<h3 id="a-kereso-oldal">A kereső oldal<a class="headerlink" href="#a-kereso-oldal" title="Permanent link">&para;</a></h3>
<p>A panelek elkészítése után készítsük el az őket összefogó <code>ProductSearchScreen</code> képernyőt. </p>
<p><code>ProductSearchScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.FloatingActionButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.IconButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.TopAppBar</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.automirrored.filled.ArrowBack</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Add</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.ExperimentalMaterial3AdaptiveApi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.layout.AnimatedPane</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.layout.ListDetailPaneScaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.layout.ListDetailPaneScaffoldRole</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.layout.PaneAdaptedValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.layout.PaneScaffoldDirective</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.navigation.rememberListDetailPaneScaffoldNavigator</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.rememberCoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.pane.details.ProductDetailsPane</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.pane.list.ProductListPane</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.getString</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.koinInject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_products</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3AdaptiveApi</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@Preview</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProductSearchScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">ProductSearchViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinInject</span><span class="p">(),</span>
<span class="w">    </span><span class="n">onFabClick</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberCoroutineScope</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scaffoldNavigator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberListDetailPaneScaffoldNavigator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">twoPane</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">scaffoldNavigator</span><span class="p">.</span><span class="na">scaffoldValue</span><span class="o">[</span><span class="n">ListDetailPaneScaffoldRole</span><span class="p">.</span><span class="na">List</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PaneAdaptedValue</span><span class="p">.</span><span class="na">Hidden</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TopAppBar</span><span class="p">(</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_products</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">navigationIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">twoPane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">scaffoldNavigator</span><span class="p">.</span><span class="na">navigateBack</span><span class="p">()</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                                </span><span class="n">Icons</span><span class="p">.</span><span class="na">AutoMirrored</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ArrowBack</span><span class="p">,</span>
<span class="w">                                </span><span class="kc">null</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">floatingActionButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">twoPane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">FloatingActionButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onFabClick</span><span class="p">,</span>
<span class="w">                    </span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">secondary</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">onSecondary</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Add</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">paddingValues</span><span class="w"> </span><span class="o">-&gt;</span>

<span class="w">        </span><span class="n">ListDetailPaneScaffold</span><span class="p">(</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scaffoldNavigator</span><span class="p">.</span><span class="na">scaffoldValue</span><span class="p">,</span>
<span class="w">            </span><span class="n">directive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PaneScaffoldDirective</span><span class="p">.</span><span class="na">Default</span><span class="p">,</span>
<span class="w">            </span><span class="n">listPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AnimatedPane</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ProductListPane</span><span class="p">(</span>
<span class="w">                        </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">,</span>
<span class="w">                        </span><span class="n">onListItemClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProductSearchScreenEvent</span><span class="p">.</span><span class="na">ProductSelected</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span>
<span class="w">                            </span><span class="n">scope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="n">scaffoldNavigator</span><span class="p">.</span><span class="na">navigateTo</span><span class="p">(</span>
<span class="w">                                    </span><span class="n">ListDetailPaneScaffoldRole</span><span class="p">.</span><span class="na">Detail</span><span class="p">,</span>
<span class="w">                                    </span><span class="nb">it</span>
<span class="w">                                </span><span class="p">)</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">detailPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AnimatedPane</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Composable</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">scaffoldNavigator</span><span class="p">.</span><span class="na">currentDestination</span><span class="o">?.</span><span class="na">content</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">ProductDetailsPane</span><span class="p">(</span><span class="n">selectedProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">)</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">twoPane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Box</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">().</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">content</span><span class="p">()</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">content</span><span class="p">()</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt azt szeretnénk, hogy a felületünk a képernyő méretétől függően adaptívan, máshogy jelenjen meg. Ehhez a <code>ListDetailPaneScaffold</code>-ot fogjuk használni. Az állapot meghatározását és a panelok kezelését egy <code>ListDetailPaneScaffoldNavigator</code>-ra bízzuk. Ettől tudjuk elkérni, hogy az egyes paneljeink milyen állapotban vannak, így például meg tudjuk határozni, hogy mikor vagyunk egy és mikor kétpanelos (twoPane) állapotban.</p>
<p>Ettől a <em>twoPane</em> állapottól függően jelenítjük meg a <em>TopAppBar</em>-on a navigációs ikont vagy éppen a <em>FloatingActionButton</em>-t.</p>
<p>A <code>ListDetailPaneScaffold</code> lista peneljénél megjelenítjük a <code>ProductListPane</code> panelunkat, aminek átadjuk az állapotot, valamint listaelemre kattintás esetén a navigáció előtt <code>ProductSearchScreenEvent.ProductSelected</code> eseményt küldünk.</p>
<p>Figyeljük meg, hogy hogyan valósítjuk meg a <em>detailPane</em>-t. <em>twoPane</em> állapot esetén egy <em>Box</em>-ba behelyezve <em>modifier</em>-ekkel jelenítjük meg, míg ellenkező esetben <em>Box nélkül</em>.</p>
<h3 id="fuggoseginjektalas">Függőséginjektálás<a class="headerlink" href="#fuggoseginjektalas" title="Permanent link">&para;</a></h3>
<p>Ezzel elkészültünk a terméklista felülettel. Ahhoz, hogy tesztelni tudjuk, meg kell oldanunk a <em>repository</em> és a <em>viewmodel</em> példányosítását. Bízzuk ezt a <em>Koin</em>-ra. Készítsük el a <code>domain.di</code> <em>package</em>-ben az alábbi modulokat:</p>
<p><code>RepositoryModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.IProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.MemoryProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.singleOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.bind</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">repositoryModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">singleOf</span><span class="p">(</span><span class="o">::</span><span class="n">MemoryProductRepository</span><span class="p">).</span><span class="na">bind</span><span class="o">&lt;</span><span class="n">IProductRepository</span><span class="o">&gt;</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>és</p>
<p><code>ProductModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.ProductSearchViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModelOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">productModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModelOf</span><span class="p">(</span><span class="o">::</span><span class="n">ProductSearchViewModel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Majd indítsuk is el őket az <code>initKoin</code> függvényben:</p>
<p><code>initKoin.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">initKoin</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">startKoin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">modules</span><span class="p">(</span><span class="n">repositoryModule</span><span class="p">,</span><span class="w"> </span><span class="n">productModule</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ha ezekkel megvagyunk, az alkalmazásunk már futtatható. Ideiglenesen illesszük be a7 <code>App</code> függvényünkbe a <code>ProductSearchScreen</code>-t.</p>
<p><code>App.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">initKoin</span><span class="p">()</span>

<span class="w">    </span><span class="n">MaterialTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ProductSearchScreen</span><span class="p">(</span><span class="n">onFabClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Futtassuk az alkalmazást! Most már látható a listánk, és képernyőmérettől függően máshogyan jelenik meg.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts <strong>két képernyőképet</strong>, amelyen látszik az elkészített felület <strong>egy- illetve kétpanelos</strong> változatban! A képernyőképen az egyik <strong>termék nevét cseréld le a saját nevedre</strong>! </p>
<p>A képet a megoldásban a repository-ba f1a.png és f1b.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="uj-termek-felvetele-1-pont">Új termék felvétele ( 1 pont)<a class="headerlink" href="#uj-termek-felvetele-1-pont" title="Permanent link">&para;</a></h2>
<h3 id="prezentacios-reteg">Prezentációs réteg<a class="headerlink" href="#prezentacios-reteg" title="Permanent link">&para;</a></h3>
<p>Miután már meg tudjuk jeleníteni a listánkat, oldjuk meg, hogy új terméket is fel tudjunk venni. Készítsük el a korábbiakhoz hasonlóan a <code>ProductCreateScreen</code>-t és a hozzá tartozó architekturális elemeket a <code>screen.product.create</code> <em>package</em>-be.</p>
<p><code>ProductCreateScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.rememberScrollState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.text.KeyboardOptions</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.verticalScroll</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.FloatingActionButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.IconButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedTextField</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.TopAppBar</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.automirrored.filled.ArrowBack</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.AddCircle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Save</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.draw.alpha</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.layout.ContentScale</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.KeyboardType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil3.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.painterResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.koinInject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.compose_multiplatform</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_add_new_product</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_description</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_name</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_price</span>

<span class="nd">@Preview</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProductCreateScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">onNavigateBack</span><span class="p">:</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinInject</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">()</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TopAppBar</span><span class="p">(</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_add_new_product</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">navigationIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onNavigateBack</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                                </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">AutoMirrored</span><span class="p">.</span><span class="na">Filled</span><span class="p">.</span><span class="na">ArrowBack</span><span class="p">,</span>
<span class="w">                                </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">floatingActionButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">FloatingActionButton</span><span class="p">(</span>
<span class="w">                </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">SaveProduct</span><span class="p">)</span>
<span class="w">                    </span><span class="n">onNavigateBack</span><span class="o">?.</span><span class="na">invoke</span><span class="p">()</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">primary</span><span class="p">,</span>
<span class="w">                </span><span class="n">contentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">onPrimary</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Save</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">Column</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">verticalScroll</span><span class="p">(</span><span class="n">rememberScrollState</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colors</span><span class="p">.</span><span class="na">background</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">,</span>
<span class="w">            </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">SpaceAround</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Box</span><span class="p">(</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">                </span><span class="n">contentAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">imageUrl</span><span class="p">,</span>
<span class="w">                    </span><span class="n">placeholder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">painterResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">compose_multiplatform</span><span class="p">),</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentScale</span><span class="p">.</span><span class="na">Fit</span><span class="p">,</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">().</span><span class="na">height</span><span class="p">(</span><span class="m">320.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">AddImageButtonClicked</span><span class="p">)</span>
<span class="w">                </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">AddCircle</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">.</span><span class="na">alpha</span><span class="p">(</span><span class="m">0.25f</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">            </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">                </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_name</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangeNameValue</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">singleLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">            </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">                </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">price</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_price</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">(</span><span class="s">&quot;[^0-9 ]&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="n">re</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span>
<span class="w">                        </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span>
<span class="w">                            </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangePrice</span><span class="p">(</span>
<span class="w">                                </span><span class="n">re</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Decimal</span><span class="p">),</span>
<span class="w">                </span><span class="n">singleLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">            </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">                </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">description</span><span class="p">,</span>
<span class="w">                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_description</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span>
<span class="w">                        </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangeDescriptionValue</span><span class="p">(</span>
<span class="w">                            </span><span class="nb">it</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">minLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span>
<span class="w">                </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPickingImage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//TODO</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A képernyőnkön a beviteli mezők mellett található egy kép, (ha már hozzá lett adva) egy gomb a hozzáadáshoz és egy FloatingActionButton az új elem mentéséhez. A kép hozzáadását egy későbbi fázisban oldjuk meg.</p>
<p><code>ProductCreateScreenState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.Product</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductCreateScreenState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">product</span><span class="p">:</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Product</span><span class="p">(),</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isPickingImage</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">)</span>
</code></pre></div>
<p>Itt az állapotunk csak az újonnan felveendő terméket tartalmazza, illetve azt, hogy éppen képet akarunk-e kiválasztani.</p>
<p><code>ProductCreateScreenEvent.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProductCreateScreenEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChangeNameValue</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChangeDescriptionValue</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">text</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChangePrice</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">price</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ImageSelected</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">imageUrl</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">AddImageButtonClicked</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">SaveProduct</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Eseményként viszont jóval több dolgot küldhetünk, mint korábban. Minden változás a névben, leírásban vagy árban eseményként fog érkezni a <em>ViewModel</em>-be, ahogyan a kiválasztott kép is. Ezeken kívül a felületen lévő két gomb megnyomására is eseményeket küldünk.</p>
<p><code>ProductCreateViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.IProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.CoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.Dispatchers</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">ProductCreateViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">productRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IProductRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">ProductCreateScreenState</span><span class="p">())</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>


<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangeNameValue</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">text</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangeDescriptionValue</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">text</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ChangePrice</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">price</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ImageSelected</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">imageUrl</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">SaveProduct</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">saveProduct</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">AddImageButtonClicked</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">//TODO</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">saveProduct</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CoroutineScope</span><span class="p">(</span><span class="n">coroutineContext</span><span class="p">).</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">productRepository</span><span class="p">.</span><span class="na">addProduct</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">product</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A <code>ProductCreateViewModel</code>-ben az állapot tárolása mellett az események kezeléséért felelős <code>onEvent</code> függvény és az új termék mentése található.</p>
<p>Már csak annyi dolgunk maradt, hogy a <code>ProductCreateViewModel</code>-t is megfelelően injektáljuk a <code>ProductCreateScreen</code>-be. Ehhez egészítsük ki a <code>ProductModult</code> a <em>domain.di</em> <em>package</em>-ben.</p>
<p><code>ProductModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.ProductSearchViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create.ProductCreateViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModelOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">productModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModelOf</span><span class="p">(</span><span class="o">::</span><span class="n">ProductCreateViewModel</span><span class="p">)</span>
<span class="w">    </span><span class="n">viewModelOf</span><span class="p">(</span><span class="o">::</span><span class="n">ProductSearchViewModel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="navigacio">Navigáció<a class="headerlink" href="#navigacio" title="Permanent link">&para;</a></h3>
<p>Készítsük el a navigációt a fent megvalósított két képernyőhöz. Ezt a <code>hu.bme.aut.kmp.vikted.navigation</code> <em>package</em>-be fogjuk megtenni.</p>
<p>Először is vegyük föl a képernyőket egy <code>Screen</code> osztályba. Ahhoz, hogy ne sztring összehasonlítás alapján navigáljunk, ebben az osztályban felvesszük az egyes képernyőink navigációs útvonalát "konstansként". sealed class-t alkalmazunk a lehetséges képernyők leírására, mert csak előre megadott számú képernyőnk van. </p>
<p><code>Screen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Screen</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">ProductCreate</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;product_create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">ProductSearch</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;product_search&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Ez után készítsük el a navigációs gráfot ezekkel az elemekkel. Ez egyszerű lesz, hiszen a <code>ProductSearchScreen</code>-ről indulva csak a <code>ProductCreateScreen</code>-re navigálhatunk és vissza. Itt kapnak értéket az egyes képernyők navigáció <em>callback</em>-jei.</p>
<p><code>NavGraph.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavHostController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.NavHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.ProductSearchScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create.ProductCreateScreen</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">NavGraph</span><span class="p">(</span>
<span class="w">    </span><span class="n">navHostController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">        </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navHostController</span><span class="p">,</span>
<span class="w">        </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ProductSearchScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onFabClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductCreate</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductCreate</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ProductCreateScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">popBackStack</span><span class="p">(</span>
<span class="w">                        </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">                        </span><span class="n">inclusive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Próba képpen most a <code>NavGraph</code>-ot illesszük be az alkalmazásunk belépési pontjára:</p>
<p><code>App.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">initKoin</span><span class="p">()</span>

<span class="w">    </span><span class="n">MaterialTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NavGraph</span><span class="p">(</span><span class="n">navHostController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Próbáljuk ki az alkalmazást! Most már tudunk új terméket felvenni, már csak a kép kiválasztása hiányzik.</p>
<h3 id="file-picker">File picker<a class="headerlink" href="#file-picker" title="Permanent link">&para;</a></h3>
<p>Természetesen a képek kiválasztására minden platformon más módszer használatos, így ezt platformspecifikusan kell megoldanunk. A <code>presentation.components</code> <em>package</em>-be készítsünk egy <code>ImagePicker</code> <em>Composable</em> függvényt.</p>
<p><code>ImagePicker.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>

<span class="nd">@Composable</span>
<span class="kd">expect</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">ImagePicker</span><span class="p">(</span><span class="n">onResult</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">Any?</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span>
</code></pre></div>
<p>A fuggvényt elláttuk az <strong>expect</strong> kulcsszóval, ami az jelenti, hogy ennek a függvénynek kell, hogy legyen aktuális megvalósítása a célzott platformokon. Készítsük is el ezeket!</p>
<p>Először nézzük az Androidos változatot. Navigáljunk el az <code>androidMain</code> modulban ugyanúgy a <code>hu.bme.aut.kmp.vikted.presentation.components</code> <em>package</em>-be, és adjuk hozzá az <code>ImagePicker.android.kt</code> fájlt.</p>
<p><code>ImagePicker.android.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.compose.rememberLauncherForActivityResult</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.result.PickVisualMediaRequest</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.result.contract.ActivityResultContracts</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.SideEffect</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">ImagePicker</span><span class="p">(</span><span class="n">onResult</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">Any?</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">launcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberLauncherForActivityResult</span><span class="p">(</span>
<span class="w">        </span><span class="n">contract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityResultContracts</span><span class="p">.</span><span class="na">PickVisualMedia</span><span class="p">(),</span>
<span class="w">        </span><span class="n">onResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">onResult</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">SideEffect</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">launcher</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">PickVisualMediaRequest</span><span class="p">(</span><span class="n">ActivityResultContracts</span><span class="p">.</span><span class="na">PickVisualMedia</span><span class="p">.</span><span class="na">ImageOnly</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt az Android rendszer által rendelkezésünkre bocsájtott <a href="https://developer.android.com/training/data-storage/shared/photopicker"><code>Photo picker API</code></a>-t fogjuk használni. A <em>Composable</em> függvényünkből egy <em>SideEffect</em>-en keresztül indítunk egy <em>PickVisualMedia</em> kérést. Így sem az engedélykérésekkel sem a tárhelykezeléssen nem kell foglalkoznunk, az eredményt egy uri paraméterben kapjuk vissza.</p>
<p>Az asztali megvalósításhoz a <code>desktopMain</code> modulban ugyanúgy a <code>hu.bme.aut.kmp.vikted.presentation.components</code> <em>package</em>-ben, vegyük föl az <code>ImagePicker.desktop.kt</code> fájlt.</p>
<p><code>ImagePicker.desktop.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">javax.swing.JFileChooser</span>
<span class="k">import</span><span class="w"> </span><span class="nn">javax.swing.filechooser.FileNameExtensionFilter</span>

<span class="nd">@Composable</span>
<span class="kd">actual</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">ImagePicker</span><span class="p">(</span><span class="n">onResult</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">Any?</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">fileChooser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JFileChooser</span><span class="p">()</span>
<span class="w">    </span><span class="n">fileChooser</span><span class="p">.</span><span class="na">fileFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileNameExtensionFilter</span><span class="p">(</span><span class="s">&quot;Image files&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jpeg&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileChooser</span><span class="p">.</span><span class="na">showOpenDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JFileChooser</span><span class="p">.</span><span class="na">APPROVE_OPTION</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">onResult</span><span class="p">(</span><span class="n">fileChooser</span><span class="p">.</span><span class="na">selectedFile</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">onResult</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt a klasszikus java-s fájlválasztót használjuk, ahol megadhatjuk a fájlok kiterjesztését is.</p>
<p>Miután a platformspecifikus megvalósításokkal megvagyunk, használjuk fel az <code>ImagePicker</code>-ünket a <code>ProductCreateScreen</code>-en. Egészítsük ki a képernyőt az állapot függvényében megjelenő képválasztóval:</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPickingImage</span><span class="p">)</span>
<span class="w">            </span><span class="n">ImagePicker</span><span class="p">(</span><span class="n">onResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ImageSelected</span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>Ne felejtsük el a gombnyomás hatására az állapotot is átállítani. A <code>ProductCreateScreen</code>-ből az eseményt már elküldjük a <code>ProductCreateViewModel</code>-hez, csak ott kell kiegészíteni az <code>onEvent</code> függvényt:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="p">...</span>
<span class="w">        </span><span class="k">is</span><span class="w"> </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">ImageSelected</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">imageUrl</span>
<span class="w">            </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">product</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">),</span>
<span class="w">                    </span><span class="n">isPickingImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">ProductCreateScreenEvent</span><span class="p">.</span><span class="na">AddImageButtonClicked</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">isPickingImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Próbáljuk ki az alkalmazást! Most már új elem felvételénél képet is csatolhatunk. Azt is megfigyelhetjük, hogy a <em>Coil</em> használatával a képek ugyan úgy megjelennek a háttértárakról, mint eddig a hálózatról.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts <strong>két képernyőképet</strong>, amelyen látszik az elkészített új termék hozzáadása felület <strong>egy- illetve kétpanelos</strong> változatban! A képernyőképen az <strong>új termék neve legyen a saját neptun-kódod</strong>! </p>
<p>A képeket a megoldásban a repository-ba f2a.png és f2b.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="a-felhasznalokezeles-megvalositasa-1-pont">A felhasználókezelés megvalósítása (1 pont)<a class="headerlink" href="#a-felhasznalokezeles-megvalositasa-1-pont" title="Permanent link">&para;</a></h2>
<p>Az alkalmazásunk jelenleg csak egy felhasználót támogat. Ha a memória adatbázist lecserélnénk hálózat alapúra, akkor sem tudnánk felhasználóhoz kötni a hirdetéseket. Valósítsunk meg tehát egy egyszerű authentikációt és a hozzá valófelületet a korábbiakhoz hasonlóan, majd ezt illesszük be a navigációba.</p>
<h3 id="repository">Repository<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h3>
<p>A termékek kezeléséhez hasonlóan készítsük el az authentikációt megvalósító osztályokat is a <code>data.authentication</code> <em>package</em>-ben.</p>
<p><code>IAuthenticationRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.User</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">IAuthenticationRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentUserId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">hasUser</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentUser</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">User?&gt;</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">signUp</span><span class="p">(</span>
<span class="w">        </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span>
<span class="w">        </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendRecoveryEmail</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteAccount</span><span class="p">()</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">signOut</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>és </p>
<p><code>MemoryAuthenticationRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.model.User</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MemoryAuthenticationRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IAuthenticationRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentUserId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="o">?.</span><span class="na">id</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">hasUser</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentUser</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">User?&gt;</span><span class="w"> </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentUserMutableFlow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="o">&lt;</span><span class="n">User?&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">signUp</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">email</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">email</span><span class="p">.</span><span class="na">hashCode</span><span class="p">().</span><span class="na">toString</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendRecoveryEmail</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Unit</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteAccount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">signOut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">currentUserMutableFlow</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Láthatjuk, hogy a jelenlegi megvalósításban mind a regisztráció mind a bejelentkezés csak annyit csinál, hogy a felhasználó e-mail címéből generál egy egyedi userId-t, amit elment. De nekünk most ennyi pont elég. Természetesen egy valós megvalósítás ennél komplexebb lenne.</p>
<p>Ne felejtsük el az <em>AuthenticationRepository</em> injektálását sem. Egészítsük ki tehát az eddigi <code>RepositoryModule</code>-unkat:</p>
<p><code>RepositoryModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication.IAuthenticationRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication.MemoryAuthenticationRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.MemoryProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.product.IProductRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.singleOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.bind</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">repositoryModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">singleOf</span><span class="p">(</span><span class="o">::</span><span class="n">MemoryAuthenticationRepository</span><span class="p">).</span><span class="na">bind</span><span class="o">&lt;</span><span class="n">IAuthenticationRepository</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="n">singleOf</span><span class="p">(</span><span class="o">::</span><span class="n">MemoryProductRepository</span><span class="p">).</span><span class="na">bind</span><span class="o">&lt;</span><span class="n">IProductRepository</span><span class="o">&gt;</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="az-authentikacios-felulet">Az authentikációs felület<a class="headerlink" href="#az-authentikacios-felulet" title="Permanent link">&para;</a></h3>
<p>A termék lista és részletes nézethez hasonlóan az authentikációhoz is közös <em>ViewModel</em>-t készítünk a <code>presentation.screen.authentication</code> <em>package</em>-be.</p>
<p><code>AuthenticationState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AuthenticationState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">confirmPassword</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isPasswordVisible</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isConfirmPasswordVisible</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isEmailError</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isPasswordError</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isConfirmPasswordError</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isLoggedIn</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">)</span>
</code></pre></div>
<p>Az <code>AuthenticationState</code>-ben az e-mail cím, jelszó és jelszó megerősítés mellett ezeknek a láthatóságát és esetleges hibáit tároljuk. Az <em>isLoggedIn</em> állapot azért lesz felelős, hogy a bejelentkezés vagy a kijelentkezés gombot jelenítsük-e meg a felhasználónak.</p>
<p><code>AuthenticationEvent.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AuthenticationEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">EmailChanged</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PasswordChanged</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ConfirmPasswordChanged</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">PasswordVisibilityChanged</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">ConfirmPasswordVisibilityChanged</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">LoginButtonClicked</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">SignUpButtonClicked</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Az események között a beviteli mezők értékének változása, a láthatósági ikonok megnyomása, valamint a bejelentkezés és a regisztráció gombok megnyomása szerepel.</p>
<p>Ezek alapján az <code>AuthenticationViewModel</code>-ünk így néz ki:</p>
<p><code>AuthenticationViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication.IAuthenticationRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.util.UiEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.Dispatchers</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.channels.Channel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.receiveAsFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">AuthenticationViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">authenticationRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IAuthenticationRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">AuthenticationState</span><span class="p">())</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_uiEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Channel</span><span class="o">&lt;</span><span class="n">UiEvent</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">uiEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiEvent</span><span class="p">.</span><span class="na">receiveAsFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">EmailChanged</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">email</span><span class="p">.</span><span class="na">trim</span><span class="p">()</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEmail</span><span class="p">,</span>
<span class="w">                        </span><span class="n">isEmailError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isEmailValid</span><span class="p">(</span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEmail</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordChanged</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">password</span><span class="p">.</span><span class="na">trim</span><span class="p">()</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPassword</span><span class="p">,</span>
<span class="w">                        </span><span class="n">isPasswordError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isPasswordValid</span><span class="p">(</span><span class="n">newPassword</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">ConfirmPasswordChanged</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">password</span><span class="p">.</span><span class="na">trim</span><span class="p">()</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                        </span><span class="n">confirmPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPassword</span><span class="p">,</span>
<span class="w">                        </span><span class="n">isConfirmPasswordError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isPasswordValid</span><span class="p">(</span><span class="n">newPassword</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>


<span class="w">            </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">ConfirmPasswordVisibilityChanged</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isConfirmPasswordVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">isConfirmPasswordVisible</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordVisibilityChanged</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isPasswordVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">isPasswordVisible</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">LoginButtonClicked</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">onSignIn</span><span class="p">()</span>

<span class="w">            </span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">SignUpButtonClicked</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">onSignUp</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onSignIn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isEmailValid</span><span class="p">(</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">email</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isEmailError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isPasswordValid</span><span class="p">(</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">password</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isPasswordError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span>
<span class="w">                            </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">email</span><span class="p">,</span>
<span class="w">                            </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">password</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">_uiEvent</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Success</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_uiEvent</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Failure</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onSignUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isPasswordValid</span><span class="p">(</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">password</span><span class="p">)</span>
<span class="w">                    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arePasswordsMatch</span><span class="p">(</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">password</span><span class="p">,</span>
<span class="w">                        </span><span class="n">confirmPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">confirmPassword</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">signUp</span><span class="p">(</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">email</span><span class="p">,</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">password</span><span class="p">)</span>
<span class="w">                    </span><span class="n">_uiEvent</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Success</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isEmailValid</span><span class="p">(</span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">email</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">isEmailError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                            </span><span class="n">isPasswordError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                            </span><span class="n">isConfirmPasswordError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_uiEvent</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Failure</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isEmailValid</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">email</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="sc">&#39;@&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isPasswordValid</span><span class="p">(</span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">6</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">arePasswordsMatch</span><span class="p">(</span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">confirmPassword</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">confirmPassword</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A bejelentkezési folyamatnál szükségünk lesz egy eddig nem használt módszerre. A felhasználó a felületen rákattint a <em>Bejelentkezés</em> gombra, az esemény elmegy a <em>VoewModel</em>-hez, ami meghívja a <em>Repository</em> megfelelő függvényét. Ez eddig is hasonló módon történt, most viszont szükségünk van arra is, hogy a <em>Repository</em> által visszadott választ megjelenítsük a feületen. </p>
<p>Attól függően, hogy a bejelentkezés sikeres volt-e vagy nem, vagy el kell navigálnunk a felületről vagy hibaüzenetet kell mutatnunk. Erre nem jó módszer az állapot frissítése, mert az nem csak egy pillanatnyi eseményt vált ki. Ezért tehát azt csináljuk, hogy a válasz hatására létrehozunk egy <em>UIEvent</em> eseményt, aminek <em>Success</em> vagy <em>Failure</em> példánya lehet. Ezt az eseményt egy <em>Channel</em>-re küldjük, amit az állapothoz hasonlóan egy <em>Flow</em>-ban a felület rendelkezésére bocsájtunk.</p>
<p>Készítsük is el ezt a <code>UiEvent</code> osztályt a <code>presentation.util</code> <em>package</em>-ben.</p>
<p><code>UiEvent.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.util</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">UiEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">Success</span><span class="p">:</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">()</span>

<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Failure</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Látható, hogy itt is a már jól ismert <em>sealed class</em>-t használjuk, mivel pontosan kétféle eseményünk lehet, amik közül az egyiknek adattagja is van.</p>
<p>A <em>State</em>, az <em>Event</em>-ek és a <em>ViewModel</em> után készítsük is el a felületeinket külön a <code>screen.authentication.login</code> és a <code>screen.authentication.registration</code> <em>package</em>-be.</p>
<p><code>LoginScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.login</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.width</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.shape.RoundedCornerShape</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.text.KeyboardOptions</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Button</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.IconButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedTextField</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.SnackbarHostState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.TextFieldDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Email</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.ErrorOutline</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Key</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Visibility</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.VisibilityOff</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.LaunchedEffect</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.rememberCoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.ImeAction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.KeyboardType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.PasswordVisualTransformation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.VisualTransformation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.AuthenticationEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.AuthenticationViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.util.UiEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.koinInject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_sign_in</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_to_sign_up</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_email</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_password</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">LoginScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinInject</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">onSignUpButtonClick</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">onSignIn</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberCoroutineScope</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">snackbarHostState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SnackbarHostState</span><span class="p">()</span>

<span class="w">    </span><span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">key1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModel</span><span class="p">.</span><span class="na">uiEvent</span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">onSignIn</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Failure</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">scope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">snackbarHostState</span><span class="p">.</span><span class="na">showSnackbar</span><span class="p">(</span>
<span class="w">                            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">message</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<span class="w">        </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">email</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">EmailChanged</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_email</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">leadingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Email</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">trailingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">)</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                    </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ErrorOutline</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">isEmailError</span><span class="p">,</span>
<span class="w">            </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span>
<span class="w">                </span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Email</span><span class="p">,</span>
<span class="w">                </span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Next</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">password</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordChanged</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_password</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">leadingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Key</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">trailingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ErrorOutline</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordVisible</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">VisibilityOff</span>
<span class="w">                    </span><span class="k">else</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Visibility</span>
<span class="w">                </span><span class="n">IconButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordVisibilityChanged</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icon</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">,</span>
<span class="w">            </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span>
<span class="w">                </span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Password</span><span class="p">,</span>
<span class="w">                </span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Next</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">visualTransformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordVisible</span><span class="p">)</span><span class="w"> </span><span class="n">VisualTransformation</span><span class="p">.</span><span class="na">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">PasswordVisualTransformation</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">Button</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">LoginButtonClicked</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_sign_in</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OutlinedButton</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onSignUpButtonClick</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_to_sign_up</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>és</p>
<p><code>RegistrationScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.registration</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.width</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.shape.RoundedCornerShape</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.text.KeyboardOptions</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Button</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.IconButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.OutlinedTextField</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.SnackbarHostState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.TextFieldDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Email</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.ErrorOutline</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Key</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Visibility</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.VisibilityOff</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.LaunchedEffect</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.rememberCoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.ImeAction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.KeyboardType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.PasswordVisualTransformation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.VisualTransformation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.AuthenticationEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.AuthenticationViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.util.UiEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.koinInject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_back</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_sign_up</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_confirm_password</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_email</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_password</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">RegistrationScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">AuthenticationViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinInject</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">onSignUp</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">onNavigateBack</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberCoroutineScope</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">snackbarHostState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SnackbarHostState</span><span class="p">()</span>

<span class="w">    </span><span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">key1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModel</span><span class="p">.</span><span class="na">uiEvent</span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">onSignUp</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">UiEvent</span><span class="p">.</span><span class="na">Failure</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">scope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">snackbarHostState</span><span class="p">.</span><span class="na">showSnackbar</span><span class="p">(</span>
<span class="w">                            </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">message</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<span class="w">        </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">email</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">EmailChanged</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_email</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">leadingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Email</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">trailingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">)</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                    </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ErrorOutline</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">isEmailError</span><span class="p">,</span>
<span class="w">            </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span>
<span class="w">                </span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Email</span><span class="p">,</span>
<span class="w">                </span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Next</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">password</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordChanged</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_password</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">leadingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Key</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">trailingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ErrorOutline</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordVisible</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">VisibilityOff</span>
<span class="w">                    </span><span class="k">else</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Visibility</span>
<span class="w">                </span><span class="n">IconButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">PasswordVisibilityChanged</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icon</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordError</span><span class="p">,</span>
<span class="w">            </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span>
<span class="w">                </span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Password</span><span class="p">,</span>
<span class="w">                </span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Next</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">visualTransformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isPasswordVisible</span><span class="p">)</span><span class="w"> </span><span class="n">VisualTransformation</span><span class="p">.</span><span class="na">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">PasswordVisualTransformation</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">confirmPassword</span><span class="p">,</span>
<span class="w">            </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">ConfirmPasswordChanged</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_confirm_password</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">leadingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Key</span><span class="p">,</span><span class="w"> </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">trailingIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isConfirmPasswordError</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">ErrorOutline</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isConfirmPasswordVisible</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">VisibilityOff</span>
<span class="w">                    </span><span class="k">else</span>
<span class="w">                        </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Visibility</span>
<span class="w">                </span><span class="n">IconButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">ConfirmPasswordVisibilityChanged</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icon</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">isConfirmPasswordError</span><span class="p">,</span>
<span class="w">            </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span>
<span class="w">                </span><span class="n">keyboardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardType</span><span class="p">.</span><span class="na">Password</span><span class="p">,</span>
<span class="w">                </span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Done</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">visualTransformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isConfirmPasswordVisible</span><span class="p">)</span><span class="w"> </span><span class="n">VisualTransformation</span><span class="p">.</span><span class="na">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">PasswordVisualTransformation</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">Button</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AuthenticationEvent</span><span class="p">.</span><span class="na">SignUpButtonClicked</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_sign_up</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OutlinedButton</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="n">TextFieldDefaults</span><span class="p">.</span><span class="na">MinWidth</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onNavigateBack</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_back</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Figyeljük meg, hogy hogyan kezeljül a <em>ViewModel</em> felől érkező <em>UIEvent</em>-eket. Egy <code>LaunchedEffent</code>-ben folyamatosan figyelünk, és ha a <em>Channel</em> <em>Flow</em>-n új esemény érkezik, akkor az esemény típusától függően reagálunk rá.</p>
<p>Ezek után ne felejtsük el az <code>AuthenticationViewModel</code> injektálását sem.</p>
<p><code>AuthenticationModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.AuthenticationViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModelOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">authenticationModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModelOf</span><span class="p">(</span><span class="o">::</span><span class="n">AuthenticationViewModel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><code>initKoin.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">initKoin</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">startKoin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">modules</span><span class="p">(</span><span class="n">repositoryModule</span><span class="p">,</span><span class="w"> </span><span class="n">productModule</span><span class="p">,</span><span class="w"> </span><span class="n">authenticationModule</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Elkészültünk az authentikációs felülettel. </p>
<h3 id="a-profil-felulet">A profil felület<a class="headerlink" href="#a-profil-felulet" title="Permanent link">&para;</a></h3>
<p>Ezt illesszük be egy egyszerű profil képernyőbe, ahol a későbbiekben komplexebb felhasználói adatokat is ki lehet majd írni. Készítsük tehát el a <code>ProfileScreen</code>-t és a hozzá tartozó dolgokat a <code>presentation.screen.profile</code> <em>package</em>-ben.</p>
<p><code>ProfileScreenState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProfileScreenState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">hasUser</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">)</span>
</code></pre></div>
<p><code>ProfileScreenEvent.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ProfileScreenEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">LogoutButtonClicked</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProfileScreenEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ProfileViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.data.authentication.IAuthenticationRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.CoroutineScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.Dispatchers</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">ProfileViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">authenticationRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IAuthenticationRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">ProfileScreenState</span><span class="p">())</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>


<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                </span><span class="n">hasUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">hasUser</span><span class="p">,</span>
<span class="w">                </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">currentUserId</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileScreenEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">ProfileScreenEvent</span><span class="p">.</span><span class="na">LogoutButtonClicked</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">logOut</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">logOut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CoroutineScope</span><span class="p">(</span><span class="n">coroutineContext</span><span class="p">).</span><span class="na">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">signOut</span><span class="p">()</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">hasUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authenticationRepository</span><span class="p">.</span><span class="na">hasUser</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ProfileScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Button</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.TopAppBar</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.compose.koinInject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_sign_in</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.button_label_sign_out</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.label_profile_info</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">ProfileScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">koinInject</span><span class="p">(),</span>
<span class="w">    </span><span class="n">onLoginButtonClicked</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">()</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TopAppBar</span><span class="p">(</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_profile_info</span><span class="p">))</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Box</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">            </span><span class="n">contentAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">hasUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Column</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello </span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">userId</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="si">}</span><span class="s"> user!&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">                    </span><span class="n">Button</span><span class="p">(</span>
<span class="w">                        </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">ProfileScreenEvent</span><span class="p">.</span><span class="na">LogoutButtonClicked</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_sign_out</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Button</span><span class="p">(</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onLoginButtonClicked</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">button_label_sign_in</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt se felejtsül el az injektálást:</p>
<p><code>ProfileModule.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile.ProfileViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.core.module.dsl.viewModelOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.koin.dsl.module</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">profileModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">viewModelOf</span><span class="p">(</span><span class="o">::</span><span class="n">ProfileViewModel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><code>initKoin.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">initKoin</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">startKoin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">modules</span><span class="p">(</span><span class="n">repositoryModule</span><span class="p">,</span><span class="w"> </span><span class="n">authenticationModule</span><span class="p">,</span><span class="w"> </span><span class="n">productModule</span><span class="p">,</span><span class="w"> </span><span class="n">profileModule</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="a-navigacio">A navigáció<a class="headerlink" href="#a-navigacio" title="Permanent link">&para;</a></h3>
<p>Miután megvagyunk a <code>ProfileScreen</code>-nel, illesszük be ezt is az alkalmazásba egy komplexebb navigációval. Szeretnénk, ha ez is adaptívan működne, így egy <code>NavigationSuiteScaffold</code>-ot fogunk használni. Ezzel kis képernyőn <em>BottomNavigationBar</em>-unk, nagy képernyőn viszont <em>NavigationRail</em>-ünk lesz.</p>
<p>Először egészítsük ki a <code>Screen</code> osztályunkat az újonnan létrehozott képernyőkkel a <code>navigation</code> <em>package</em>-ben.</p>
<p><code>Screen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Screen</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">ProductCreate</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;product_create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">ProductSearch</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;product_search&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">Profile</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;profile&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">Login</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;login&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">Register</span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="s">&quot;register&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Vegyük fel a <em>Composable</em>-jeinket a <code>NavGraph</code>-ba is.</p>
<p><code>NavGraph.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavHostController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.NavHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.login.LoginScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.authentication.registration.RegistrationScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.search.ProductSearchScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.product.create.ProductCreateScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.presentation.screen.profile.ProfileScreen</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">NavGraph</span><span class="p">(</span>
<span class="w">    </span><span class="n">navHostController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">        </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navHostController</span><span class="p">,</span>
<span class="w">        </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ProductSearchScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onFabClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductCreate</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductCreate</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ProductCreateScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">popBackStack</span><span class="p">(</span>
<span class="w">                        </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">                        </span><span class="n">inclusive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">Login</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LoginScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onSignUpButtonClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">Register</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">onSignIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">Profile</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ProfileScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onLoginButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">Login</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">Register</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">RegistrationScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">popBackStack</span><span class="p">(</span>
<span class="w">                        </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">Login</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">                        </span><span class="n">inclusive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">Login</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onSignUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">navHostController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt vannak tehát meghívva a konkrét képernyőink <em>Composable</em>-jei. Vagyis, amikor a <em>NavHostController</em> ilyen navigációs parancsot kap, innen fogja tudni, hogy milyen képernyőt töltsön be.</p>
<p>A navigációs "menü" akár az oldal alján van, akár a bal oldalán, "menüpontokból" épül fel. Készítsük el ezeket a egy <code>NavigationItems</code> osztályba.</p>
<p><code>NavigationItems.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Person</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Search</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.vector.ImageVector</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.StringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.Res</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.nav_label_profile</span>
<span class="k">import</span><span class="w"> </span><span class="nn">vikted.composeapp.generated.resources.nav_label_search</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">NavigationItems</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w">  </span><span class="n">StringResource</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="p">:</span><span class="w"> </span><span class="n">ImageVector</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SearchItem</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">nav_label_search</span><span class="p">,</span>
<span class="w">        </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">ProductSearch</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Search</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">    </span><span class="n">ProfileItem</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Res</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">nav_label_profile</span><span class="p">,</span>
<span class="w">        </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">Profile</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Person</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt egy <em>enum class</em>-ba gyűjtjük össze a navigációs elemeket, amiknek van neve, útvonala és ikonja is. Figyeljük meg, hogy hogyan hivatkozzuk a szöveges erőforrásokat a menüpont nevéhez.</p>
<p>Végül pedig egy <code>AppNavigation</code> <em>Composable</em>-be valósítsuk meg a navigációt a <code>NavigationSuiteScaffold</code>-dal.</p>
<p><code>AppNavigation.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.currentWindowAdaptiveInfo</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.navigationsuite.NavigationSuiteScaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.navigationsuite.NavigationSuiteScaffoldDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.adaptive.navigationsuite.NavigationSuiteType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavGraph.Companion.findStartDestination</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavHostController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.currentBackStackEntryAsState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.rememberNavController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.window.core.layout.WindowWidthSizeClass</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.resources.stringResource</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">AppNavigation</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">()</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">navBackStackEntry</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">currentBackStackEntryAsState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navBackStackEntry</span><span class="o">?.</span><span class="na">destination</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">windowWidthSizeClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentWindowAdaptiveInfo</span><span class="p">().</span><span class="na">windowSizeClass</span><span class="p">.</span><span class="na">windowWidthSizeClass</span>

<span class="w">    </span><span class="n">NavigationSuiteScaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">,</span>
<span class="w">        </span><span class="n">navigationSuiteItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">NavigationItems</span><span class="p">.</span><span class="na">entries</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navItem</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">item</span><span class="p">(</span>
<span class="w">                    </span><span class="n">selected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentDestination</span><span class="o">?.</span><span class="na">route</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">navItem</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">                    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">navItem</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">popUpTo</span><span class="p">(</span><span class="n">navController</span><span class="p">.</span><span class="na">graph</span><span class="p">.</span><span class="na">findStartDestination</span><span class="p">().</span><span class="na">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="n">saveState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                            </span><span class="n">launchSingleTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                            </span><span class="n">restoreState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                            </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navItem</span><span class="p">.</span><span class="na">icon</span><span class="p">,</span>
<span class="w">                            </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">navItem</span><span class="p">.</span><span class="na">title</span><span class="p">))</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">layoutType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">windowWidthSizeClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WindowWidthSizeClass</span><span class="p">.</span><span class="na">MEDIUM</span><span class="p">)</span>
<span class="w">            </span><span class="n">NavigationSuiteType</span><span class="p">.</span><span class="na">NavigationDrawer</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">NavigationSuiteScaffoldDefaults</span><span class="p">.</span><span class="na">calculateFromAdaptiveInfo</span><span class="p">(</span>
<span class="w">                </span><span class="n">currentWindowAdaptiveInfo</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NavGraph</span><span class="p">(</span><span class="n">navController</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Itt a <code>NavigationSuiteScaffold</code> elemei az imént létrehozott <code>NavigationItems</code> enum elemei. Láthatjuk, hogy jelen esetben a <code>NavigationSuiteScaffold</code> az elemre kattintáskor csak a navigációs parancsot adja ki, és a <em>content</em>-ként megjelenített <code>NavGraph</code> végzi a valós megjelenítést. Szintén érdemes megfigyelni, hogy hogyan állítjuk be, hogy közepes képernyőméret esetén teljes <em>NavigationDrawer</em>-ként jelenjen meg a navigáció, míg egyéb esetben az automatikusat használjuk.</p>
<p>Utolsó lépésként cseréljük le az <code>App</code> függévnyben a megjelenítendő <code>NavGraph</code>-ot az új <code>AppNavigation</code>-ünkre:</p>
<p><code>App.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted</span>


<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.safeDrawingPadding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.*</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.domain.di.initKoin</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.kmp.vikted.navigation.AppNavigation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.jetbrains.compose.ui.tooling.preview.Preview</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">initKoin</span><span class="p">()</span>

<span class="w">    </span><span class="n">MaterialTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AppNavigation</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">safeDrawingPadding</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Próbáljuk ki az alkalmazást! Most már a bejelentkezésünk és a navigációnk is működik.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts <strong>három képernyőképet</strong>, amelyen látszik az elkészített bejelentkező felület a navigációval együtt <strong>mind a három</strong> változatban! A képernyőképen az <strong>e-mail cím helyén legyen a saját neptun-kódod</strong>! </p>
<p>A képeket a megoldásban a repository-ba f3a.png és f3b.png és f3c.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="onallo-feladat-bejelentkezes-fuggo-hozzaadas-gomb-1-pont">Önálló feladat - Bejelentkezés függő hozzáadás gomb (1 pont)<a class="headerlink" href="#onallo-feladat-bejelentkezes-fuggo-hozzaadas-gomb-1-pont" title="Permanent link">&para;</a></h2>
<p>Valósítsuk meg, hogy a termék lista felületen csak akkor jelenjen meg az új termék hozzáadása gomb, ha a felhasználó be van jelentkezve!</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts <strong>egy képernyőképet</strong>, amelyen látszik, hogy a gomb el van rejtve akkor, amikor a felhasználó be van jelentkezve, illetve az <strong>ehhez tartozó kódrészlet</strong>! Ne felejtsük, hogy ehhez bejelentkezéskor be kell állítanunk a megfelelő userId-t is!</p>
<p>A képet a megoldásban a repository-ba f4.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="onallo-feladat-lokalizacio-tamogatasa-1-pont">Önálló feladat - Lokalizáció támogatása (1 pont)<a class="headerlink" href="#onallo-feladat-lokalizacio-tamogatasa-1-pont" title="Permanent link">&para;</a></h2>
<p>Adjuk hozzá a projektünkhöz a magyar nyelvet erőforrások használatával!</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts <strong>egy képernyőképet</strong>, amelyen látszik, hogy a <strong>felület magyar</strong>, illetve az <strong>ehhez tartozó kódrészlet</strong>!! </p>
<p>A képet a megoldásban a repository-ba f5.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2025. május 13. 13:39:19">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="2025. május 13. 13:39:19 CEST"><span class="timeago" datetime="2025-05-13T13:39:19+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025. május 13. 13:39:19 CEST">2025-05-13</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav><a href="https://github.com/gazdilaci" target="_blank" rel="noopener noreferrer" class="md-author" title="@gazdilaci">
          <img src="https://avatars.githubusercontent.com/u/23335752?v=4?size=72" alt="@gazdilaci">
        </a></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Vissza a tetejére
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.code.copy"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>